// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`date functions batch 1 > 'Day' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "DAY({Attachment})",
  "funcId": "Day",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'Day' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "DAY({AutoNumber})",
  "funcId": "Day",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "1",
  "sql": "EXTRACT(DAY FROM (to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Day' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "DAY({Button})",
  "funcId": "Day",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(DAY FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Day' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "DAY({Checkbox})",
  "funcId": "Day",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(DAY FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Day' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "DAY({ConditionalLookupType})",
  "funcId": "Day",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(DAY FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Day' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "DAY({ConditionalRollupType})",
  "funcId": "Day",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(DAY FROM (to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Day' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "DAY({CreatedBy})",
  "funcId": "Day",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(DAY FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Day' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "DAY({CreatedTime})",
  "funcId": "Day",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(DAY FROM (("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Day' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "DAY({Date})",
  "funcId": "Day",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "3",
  "sql": "EXTRACT(DAY FROM (("t"."Date")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Day' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "DAY({FormulaType})",
  "funcId": "Day",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "1",
  "sql": "EXTRACT(DAY FROM (to_timestamp((10)::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Day' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "DAY({LastModifiedBy})",
  "funcId": "Day",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(DAY FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Day' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "DAY({LastModifiedTime})",
  "funcId": "Day",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(DAY FROM (("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Day' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "DAY({LinkType})",
  "funcId": "Day",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(DAY FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Day' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "DAY({LongText})",
  "funcId": "Day",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE EXTRACT(DAY FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Day' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "DAY({LookupType})",
  "funcId": "Day",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(DAY FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Day' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "DAY({MultipleSelect})",
  "funcId": "Day",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "[null, null]",
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(DAY FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements(COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Day' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "DAY({Number})",
  "funcId": "Day",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "1",
  "sql": "EXTRACT(DAY FROM (to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Day' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "DAY({Rating})",
  "funcId": "Day",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "1",
  "sql": "EXTRACT(DAY FROM (to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Day' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "DAY({RollupType})",
  "funcId": "Day",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(DAY FROM (to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Day' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "DAY({SingleLineText})",
  "funcId": "Day",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE EXTRACT(DAY FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Day' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "DAY({SingleSelect})",
  "funcId": "Day",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(DAY FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Day' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "DAY({User})",
  "funcId": "Day",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'Hour' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "HOUR({Attachment})",
  "funcId": "Hour",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'Hour' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "HOUR({AutoNumber})",
  "funcId": "Hour",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "0",
  "sql": "EXTRACT(HOUR FROM (to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Hour' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "HOUR({Button})",
  "funcId": "Hour",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(HOUR FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Hour' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "HOUR({Checkbox})",
  "funcId": "Hour",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(HOUR FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Hour' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "HOUR({ConditionalLookupType})",
  "funcId": "Hour",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(HOUR FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Hour' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "HOUR({ConditionalRollupType})",
  "funcId": "Hour",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(HOUR FROM (to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Hour' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "HOUR({CreatedBy})",
  "funcId": "Hour",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(HOUR FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Hour' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "HOUR({CreatedTime})",
  "funcId": "Hour",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(HOUR FROM (("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Hour' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "HOUR({Date})",
  "funcId": "Hour",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(HOUR FROM (("t"."Date")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Hour' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "HOUR({FormulaType})",
  "funcId": "Hour",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "0",
  "sql": "EXTRACT(HOUR FROM (to_timestamp((10)::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Hour' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "HOUR({LastModifiedBy})",
  "funcId": "Hour",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(HOUR FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Hour' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "HOUR({LastModifiedTime})",
  "funcId": "Hour",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(HOUR FROM (("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Hour' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "HOUR({LinkType})",
  "funcId": "Hour",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(HOUR FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Hour' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "HOUR({LongText})",
  "funcId": "Hour",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE EXTRACT(HOUR FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Hour' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "HOUR({LookupType})",
  "funcId": "Hour",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(HOUR FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Hour' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "HOUR({MultipleSelect})",
  "funcId": "Hour",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "[null, null]",
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(HOUR FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements(COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Hour' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "HOUR({Number})",
  "funcId": "Hour",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "0",
  "sql": "EXTRACT(HOUR FROM (to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Hour' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "HOUR({Rating})",
  "funcId": "Hour",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "0",
  "sql": "EXTRACT(HOUR FROM (to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Hour' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "HOUR({RollupType})",
  "funcId": "Hour",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(HOUR FROM (to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Hour' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "HOUR({SingleLineText})",
  "funcId": "Hour",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE EXTRACT(HOUR FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Hour' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "HOUR({SingleSelect})",
  "funcId": "Hour",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(HOUR FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Hour' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "HOUR({User})",
  "funcId": "Hour",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'Minute' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "MINUTE({Attachment})",
  "funcId": "Minute",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'Minute' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "MINUTE({AutoNumber})",
  "funcId": "Minute",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "0",
  "sql": "EXTRACT(MINUTE FROM (to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Minute' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "MINUTE({Button})",
  "funcId": "Minute",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(MINUTE FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Minute' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "MINUTE({Checkbox})",
  "funcId": "Minute",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(MINUTE FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Minute' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "MINUTE({ConditionalLookupType})",
  "funcId": "Minute",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(MINUTE FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Minute' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "MINUTE({ConditionalRollupType})",
  "funcId": "Minute",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(MINUTE FROM (to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Minute' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "MINUTE({CreatedBy})",
  "funcId": "Minute",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(MINUTE FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Minute' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "MINUTE({CreatedTime})",
  "funcId": "Minute",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(MINUTE FROM (("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Minute' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "MINUTE({Date})",
  "funcId": "Minute",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(MINUTE FROM (("t"."Date")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Minute' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "MINUTE({FormulaType})",
  "funcId": "Minute",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "0",
  "sql": "EXTRACT(MINUTE FROM (to_timestamp((10)::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Minute' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "MINUTE({LastModifiedBy})",
  "funcId": "Minute",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(MINUTE FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Minute' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "MINUTE({LastModifiedTime})",
  "funcId": "Minute",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(MINUTE FROM (("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Minute' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "MINUTE({LinkType})",
  "funcId": "Minute",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(MINUTE FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Minute' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "MINUTE({LongText})",
  "funcId": "Minute",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE EXTRACT(MINUTE FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Minute' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "MINUTE({LookupType})",
  "funcId": "Minute",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(MINUTE FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Minute' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "MINUTE({MultipleSelect})",
  "funcId": "Minute",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "[null, null]",
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(MINUTE FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements(COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Minute' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "MINUTE({Number})",
  "funcId": "Minute",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "0",
  "sql": "EXTRACT(MINUTE FROM (to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Minute' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "MINUTE({Rating})",
  "funcId": "Minute",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "0",
  "sql": "EXTRACT(MINUTE FROM (to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Minute' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "MINUTE({RollupType})",
  "funcId": "Minute",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(MINUTE FROM (to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Minute' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "MINUTE({SingleLineText})",
  "funcId": "Minute",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE EXTRACT(MINUTE FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Minute' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "MINUTE({SingleSelect})",
  "funcId": "Minute",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(MINUTE FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Minute' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "MINUTE({User})",
  "funcId": "Minute",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'Month' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "MONTH({Attachment})",
  "funcId": "Month",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'Month' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "MONTH({AutoNumber})",
  "funcId": "Month",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "1",
  "sql": "EXTRACT(MONTH FROM (to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Month' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "MONTH({Button})",
  "funcId": "Month",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(MONTH FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Month' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "MONTH({Checkbox})",
  "funcId": "Month",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(MONTH FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Month' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "MONTH({ConditionalLookupType})",
  "funcId": "Month",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(MONTH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Month' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "MONTH({ConditionalRollupType})",
  "funcId": "Month",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(MONTH FROM (to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Month' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "MONTH({CreatedBy})",
  "funcId": "Month",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(MONTH FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Month' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "MONTH({CreatedTime})",
  "funcId": "Month",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(MONTH FROM (("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Month' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "MONTH({Date})",
  "funcId": "Month",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "2",
  "sql": "EXTRACT(MONTH FROM (("t"."Date")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Month' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "MONTH({FormulaType})",
  "funcId": "Month",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "1",
  "sql": "EXTRACT(MONTH FROM (to_timestamp((10)::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Month' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "MONTH({LastModifiedBy})",
  "funcId": "Month",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(MONTH FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Month' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "MONTH({LastModifiedTime})",
  "funcId": "Month",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(MONTH FROM (("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Month' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "MONTH({LinkType})",
  "funcId": "Month",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(MONTH FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Month' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "MONTH({LongText})",
  "funcId": "Month",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE EXTRACT(MONTH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Month' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "MONTH({LookupType})",
  "funcId": "Month",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(MONTH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Month' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "MONTH({MultipleSelect})",
  "funcId": "Month",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "[null, null]",
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(MONTH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements(COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Month' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "MONTH({Number})",
  "funcId": "Month",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "1",
  "sql": "EXTRACT(MONTH FROM (to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Month' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "MONTH({Rating})",
  "funcId": "Month",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "1",
  "sql": "EXTRACT(MONTH FROM (to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Month' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "MONTH({RollupType})",
  "funcId": "Month",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(MONTH FROM (to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Month' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "MONTH({SingleLineText})",
  "funcId": "Month",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE EXTRACT(MONTH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Month' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "MONTH({SingleSelect})",
  "funcId": "Month",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(MONTH FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Month' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "MONTH({User})",
  "funcId": "Month",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "WEEKNUM({Attachment})",
  "funcId": "WeekNum",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "WEEKNUM({AutoNumber})",
  "funcId": "WeekNum",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "1",
  "sql": "EXTRACT(WEEK FROM (to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "WEEKNUM({Button})",
  "funcId": "WeekNum",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(WEEK FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "WEEKNUM({Checkbox})",
  "funcId": "WeekNum",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(WEEK FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "WEEKNUM({ConditionalLookupType})",
  "funcId": "WeekNum",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(WEEK FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "WEEKNUM({ConditionalRollupType})",
  "funcId": "WeekNum",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(WEEK FROM (to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "WEEKNUM({CreatedBy})",
  "funcId": "WeekNum",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(WEEK FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "WEEKNUM({CreatedTime})",
  "funcId": "WeekNum",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(WEEK FROM (("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "WEEKNUM({Date})",
  "funcId": "WeekNum",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "5",
  "sql": "EXTRACT(WEEK FROM (("t"."Date")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "WEEKNUM({FormulaType})",
  "funcId": "WeekNum",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "1",
  "sql": "EXTRACT(WEEK FROM (to_timestamp((10)::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "WEEKNUM({LastModifiedBy})",
  "funcId": "WeekNum",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(WEEK FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "WEEKNUM({LastModifiedTime})",
  "funcId": "WeekNum",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(WEEK FROM (("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "WEEKNUM({LinkType})",
  "funcId": "WeekNum",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(WEEK FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "WEEKNUM({LongText})",
  "funcId": "WeekNum",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE EXTRACT(WEEK FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "WEEKNUM({LookupType})",
  "funcId": "WeekNum",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(WEEK FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "WEEKNUM({MultipleSelect})",
  "funcId": "WeekNum",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "[null, null]",
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(WEEK FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements(COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "WEEKNUM({Number})",
  "funcId": "WeekNum",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "1",
  "sql": "EXTRACT(WEEK FROM (to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "WEEKNUM({Rating})",
  "funcId": "WeekNum",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "1",
  "sql": "EXTRACT(WEEK FROM (to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "WEEKNUM({RollupType})",
  "funcId": "WeekNum",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(WEEK FROM (to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "WEEKNUM({SingleLineText})",
  "funcId": "WeekNum",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE EXTRACT(WEEK FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "WEEKNUM({SingleSelect})",
  "funcId": "WeekNum",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(WEEK FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'WeekNum' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "WEEKNUM({User})",
  "funcId": "WeekNum",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "WEEKDAY({Attachment})",
  "funcId": "Weekday",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "WEEKDAY({AutoNumber})",
  "funcId": "Weekday",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "4",
  "sql": "EXTRACT(DOW FROM (to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "WEEKDAY({Button})",
  "funcId": "Weekday",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(DOW FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "WEEKDAY({Checkbox})",
  "funcId": "Weekday",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(DOW FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "WEEKDAY({ConditionalLookupType})",
  "funcId": "Weekday",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(DOW FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "WEEKDAY({ConditionalRollupType})",
  "funcId": "Weekday",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(DOW FROM (to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "WEEKDAY({CreatedBy})",
  "funcId": "Weekday",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(DOW FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "WEEKDAY({CreatedTime})",
  "funcId": "Weekday",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(DOW FROM (("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "WEEKDAY({Date})",
  "funcId": "Weekday",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "6",
  "sql": "EXTRACT(DOW FROM (("t"."Date")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "WEEKDAY({FormulaType})",
  "funcId": "Weekday",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "4",
  "sql": "EXTRACT(DOW FROM (to_timestamp((10)::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "WEEKDAY({LastModifiedBy})",
  "funcId": "Weekday",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(DOW FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "WEEKDAY({LastModifiedTime})",
  "funcId": "Weekday",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(DOW FROM (("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "WEEKDAY({LinkType})",
  "funcId": "Weekday",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(DOW FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "WEEKDAY({LongText})",
  "funcId": "Weekday",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE EXTRACT(DOW FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "WEEKDAY({LookupType})",
  "funcId": "Weekday",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(DOW FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "WEEKDAY({MultipleSelect})",
  "funcId": "Weekday",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "[null, null]",
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(DOW FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements(COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "WEEKDAY({Number})",
  "funcId": "Weekday",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "4",
  "sql": "EXTRACT(DOW FROM (to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "WEEKDAY({Rating})",
  "funcId": "Weekday",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "4",
  "sql": "EXTRACT(DOW FROM (to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "WEEKDAY({RollupType})",
  "funcId": "Weekday",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(DOW FROM (to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "WEEKDAY({SingleLineText})",
  "funcId": "Weekday",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE EXTRACT(DOW FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "WEEKDAY({SingleSelect})",
  "funcId": "Weekday",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(DOW FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Weekday' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "WEEKDAY({User})",
  "funcId": "Weekday",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'Year' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "YEAR({Attachment})",
  "funcId": "Year",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 1 > 'Year' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "YEAR({AutoNumber})",
  "funcId": "Year",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "1970",
  "sql": "EXTRACT(YEAR FROM (to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Year' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "YEAR({Button})",
  "funcId": "Year",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(YEAR FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Year' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "YEAR({Checkbox})",
  "funcId": "Year",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(YEAR FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Year' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "YEAR({ConditionalLookupType})",
  "funcId": "Year",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(YEAR FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Year' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "YEAR({ConditionalRollupType})",
  "funcId": "Year",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(YEAR FROM (to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Year' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "YEAR({CreatedBy})",
  "funcId": "Year",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(YEAR FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Year' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "YEAR({CreatedTime})",
  "funcId": "Year",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0000",
  "sql": "EXTRACT(YEAR FROM (("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Year' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "YEAR({Date})",
  "funcId": "Year",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "2024",
  "sql": "EXTRACT(YEAR FROM (("t"."Date")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Year' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "YEAR({FormulaType})",
  "funcId": "Year",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "1970",
  "sql": "EXTRACT(YEAR FROM (to_timestamp((10)::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Year' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "YEAR({LastModifiedBy})",
  "funcId": "Year",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(YEAR FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Year' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "YEAR({LastModifiedTime})",
  "funcId": "Year",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0000",
  "sql": "EXTRACT(YEAR FROM (("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Year' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "YEAR({LinkType})",
  "funcId": "Year",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(YEAR FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Year' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "YEAR({LongText})",
  "funcId": "Year",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE EXTRACT(YEAR FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Year' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "YEAR({LookupType})",
  "funcId": "Year",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(YEAR FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Year' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "YEAR({MultipleSelect})",
  "funcId": "Year",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "[null, null]",
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(YEAR FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements(COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 1 > 'Year' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "YEAR({Number})",
  "funcId": "Year",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "1970",
  "sql": "EXTRACT(YEAR FROM (to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Year' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "YEAR({Rating})",
  "funcId": "Year",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "1970",
  "sql": "EXTRACT(YEAR FROM (to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Year' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "YEAR({RollupType})",
  "funcId": "Year",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(YEAR FROM (to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 1 > 'Year' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "YEAR({SingleLineText})",
  "funcId": "Year",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE EXTRACT(YEAR FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Year' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "YEAR({SingleSelect})",
  "funcId": "Year",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(YEAR FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 1 > 'Year' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "YEAR({User})",
  "funcId": "Year",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "DATETIME_DIFF({Attachment}, DATE_ADD({Attachment}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "DATETIME_DIFF({AutoNumber}, DATE_ADD({AutoNumber}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "-1",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (to_timestamp(("t"."AutoNumber")::double precision) - (to_timestamp(("t"."AutoNumber")::double precision) + ((1)::double precision) * INTERVAL '1 day')::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "DATETIME_DIFF({Button}, DATE_ADD({Button}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "DATETIME_DIFF({Checkbox}, DATE_ADD({Checkbox}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "DATETIME_DIFF({ConditionalLookupType}, DATE_ADD({ConditionalLookupType}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_datetime_diff' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) - ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "DATETIME_DIFF({ConditionalRollupType}, DATE_ADD({ConditionalRollupType}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "TRUNC((EXTRACT(EPOCH FROM (to_timestamp(("t"."ConditionalRollupType")::double precision) - (to_timestamp(("t"."ConditionalRollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "DATETIME_DIFF({CreatedBy}, DATE_ADD({CreatedBy}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "DATETIME_DIFF({CreatedTime}, DATE_ADD({CreatedTime}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "-0",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (("t"."CreatedTime")::timestamptz - (("t"."CreatedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "DATETIME_DIFF({Date}, DATE_ADD({Date}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "-1",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (("t"."Date")::timestamptz - (("t"."Date")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "DATETIME_DIFF({FormulaType}, DATE_ADD({FormulaType}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "-1",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (to_timestamp((10)::double precision) - (to_timestamp((10)::double precision) + ((1)::double precision) * INTERVAL '1 day')::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "DATETIME_DIFF({LastModifiedBy}, DATE_ADD({LastModifiedBy}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "DATETIME_DIFF({LastModifiedTime}, DATE_ADD({LastModifiedTime}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "-0",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (("t"."LastModifiedTime")::timestamptz - (("t"."LastModifiedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "DATETIME_DIFF({LinkType}, DATE_ADD({LinkType}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "DATETIME_DIFF({LongText}, DATE_ADD({LongText}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_datetime_diff' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v)) THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END) - ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "DATETIME_DIFF({LookupType}, DATE_ADD({LookupType}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_datetime_diff' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) - ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "DATETIME_DIFF({MultipleSelect}, DATE_ADD({MultipleSelect}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "DATETIME_DIFF({Number}, DATE_ADD({Number}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "-1",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (to_timestamp(("t"."Number")::double precision) - (to_timestamp(("t"."Number")::double precision) + ((1)::double precision) * INTERVAL '1 day')::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "DATETIME_DIFF({Rating}, DATE_ADD({Rating}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "-1",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (to_timestamp(("t"."Rating")::double precision) - (to_timestamp(("t"."Rating")::double precision) + ((1)::double precision) * INTERVAL '1 day')::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "DATETIME_DIFF({RollupType}, DATE_ADD({RollupType}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "TRUNC((EXTRACT(EPOCH FROM (to_timestamp(("t"."RollupType")::double precision) - (to_timestamp(("t"."RollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "DATETIME_DIFF({SingleLineText}, DATE_ADD({SingleLineText}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_datetime_diff' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v)) THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END) - ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "DATETIME_DIFF({SingleSelect}, DATE_ADD({SingleSelect}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiff' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "DATETIME_DIFF({User}, DATE_ADD({User}, 1, "day"), "day")",
  "funcId": "DatetimeDiff",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "DATETIME_DIFF({Attachment}, DATE_ADD({Attachment}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "DATETIME_DIFF({AutoNumber}, DATE_ADD({AutoNumber}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "DATETIME_DIFF({Button}, DATE_ADD({Button}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "DATETIME_DIFF({Checkbox}, DATE_ADD({Checkbox}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "DATETIME_DIFF({ConditionalLookupType}, DATE_ADD({ConditionalLookupType}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "DATETIME_DIFF({ConditionalRollupType}, DATE_ADD({ConditionalRollupType}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "DATETIME_DIFF({CreatedBy}, DATE_ADD({CreatedBy}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "DATETIME_DIFF({CreatedTime}, DATE_ADD({CreatedTime}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "DATETIME_DIFF({Date}, DATE_ADD({Date}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "DATETIME_DIFF({FormulaType}, DATE_ADD({FormulaType}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "DATETIME_DIFF({LastModifiedBy}, DATE_ADD({LastModifiedBy}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "DATETIME_DIFF({LastModifiedTime}, DATE_ADD({LastModifiedTime}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "DATETIME_DIFF({LinkType}, DATE_ADD({LinkType}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "DATETIME_DIFF({LongText}, DATE_ADD({LongText}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "DATETIME_DIFF({LookupType}, DATE_ADD({LookupType}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "DATETIME_DIFF({MultipleSelect}, DATE_ADD({MultipleSelect}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "DATETIME_DIFF({Number}, DATE_ADD({Number}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "DATETIME_DIFF({Rating}, DATE_ADD({Rating}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "DATETIME_DIFF({RollupType}, DATE_ADD({RollupType}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "DATETIME_DIFF({SingleLineText}, DATE_ADD({SingleLineText}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "DATETIME_DIFF({SingleSelect}, DATE_ADD({SingleSelect}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffInvalidUnit' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "DATETIME_DIFF({User}, DATE_ADD({User}, 1, "day"), "banana")",
  "funcId": "DatetimeDiffInvalidUnit",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {Attachment})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {AutoNumber})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {Button})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {Checkbox})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {ConditionalLookupType})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {ConditionalRollupType})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {CreatedBy})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {CreatedTime})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {Date})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {FormulaType})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {LastModifiedBy})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {LastModifiedTime})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {LinkType})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {LongText})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) OR (LOWER("t"."LongText") IS NULL OR LOWER("t"."LongText") NOT IN ('millisecond', 'milliseconds', 'second', 'seconds', 'minute', 'minutes', 'hour', 'hours', 'day', 'days', 'week', 'weeks', 'month', 'months', 'quarter', 'quarters', 'year', 'years'))) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (LOWER("t"."LongText") IS NULL OR LOWER("t"."LongText") NOT IN ('millisecond', 'milliseconds', 'second', 'seconds', 'minute', 'minutes', 'hour', 'hours', 'day', 'days', 'week', 'weeks', 'month', 'months', 'quarter', 'quarters', 'year', 'years')) THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE '#ERROR:ARG:invalid_datetime_diff_unit' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) OR (LOWER("t"."LongText") IS NULL OR LOWER("t"."LongText") NOT IN ('millisecond', 'milliseconds', 'second', 'seconds', 'minute', 'minutes', 'hour', 'hours', 'day', 'days', 'week', 'weeks', 'month', 'months', 'quarter', 'quarters', 'year', 'years'))) THEN NULL ELSE (CASE
      WHEN LOWER("t"."LongText") IN ('millisecond', 'milliseconds') THEN TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)))) * 1000)
      WHEN LOWER("t"."LongText") IN ('second', 'seconds') THEN TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)))))
      WHEN LOWER("t"."LongText") IN ('minute', 'minutes') THEN TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)))) / 60)
      WHEN LOWER("t"."LongText") IN ('hour', 'hours') THEN TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)))) / 3600)
      WHEN LOWER("t"."LongText") IN ('week', 'weeks') THEN TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)))) / (86400 * 7))
      WHEN LOWER("t"."LongText") IN ('month', 'months') THEN TRUNC(EXTRACT(MONTH FROM AGE((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END), (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END))) + EXTRACT(YEAR FROM AGE((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END), (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END))) * 12)
      WHEN LOWER("t"."LongText") IN ('quarter', 'quarters') THEN TRUNC((EXTRACT(MONTH FROM AGE((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END), (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END))) + EXTRACT(YEAR FROM AGE((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END), (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END))) * 12) / 3.0)
      WHEN LOWER("t"."LongText") IN ('year', 'years') THEN TRUNC(EXTRACT(YEAR FROM AGE((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END), (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END))))
      WHEN LOWER("t"."LongText") IN ('day', 'days') THEN TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)))) / 86400)
      ELSE NULL::double precision
    END) END))::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {LookupType})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {MultipleSelect})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {Number})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {Rating})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {RollupType})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {SingleLineText})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) OR (LOWER("t"."SingleLineText") IS NULL OR LOWER("t"."SingleLineText") NOT IN ('millisecond', 'milliseconds', 'second', 'seconds', 'minute', 'minutes', 'hour', 'hours', 'day', 'days', 'week', 'weeks', 'month', 'months', 'quarter', 'quarters', 'year', 'years'))) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (LOWER("t"."SingleLineText") IS NULL OR LOWER("t"."SingleLineText") NOT IN ('millisecond', 'milliseconds', 'second', 'seconds', 'minute', 'minutes', 'hour', 'hours', 'day', 'days', 'week', 'weeks', 'month', 'months', 'quarter', 'quarters', 'year', 'years')) THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE '#ERROR:ARG:invalid_datetime_diff_unit' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) OR (LOWER("t"."SingleLineText") IS NULL OR LOWER("t"."SingleLineText") NOT IN ('millisecond', 'milliseconds', 'second', 'seconds', 'minute', 'minutes', 'hour', 'hours', 'day', 'days', 'week', 'weeks', 'month', 'months', 'quarter', 'quarters', 'year', 'years'))) THEN NULL ELSE (CASE
      WHEN LOWER("t"."SingleLineText") IN ('millisecond', 'milliseconds') THEN TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)))) * 1000)
      WHEN LOWER("t"."SingleLineText") IN ('second', 'seconds') THEN TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)))))
      WHEN LOWER("t"."SingleLineText") IN ('minute', 'minutes') THEN TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)))) / 60)
      WHEN LOWER("t"."SingleLineText") IN ('hour', 'hours') THEN TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)))) / 3600)
      WHEN LOWER("t"."SingleLineText") IN ('week', 'weeks') THEN TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)))) / (86400 * 7))
      WHEN LOWER("t"."SingleLineText") IN ('month', 'months') THEN TRUNC(EXTRACT(MONTH FROM AGE((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END), (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END))) + EXTRACT(YEAR FROM AGE((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END), (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END))) * 12)
      WHEN LOWER("t"."SingleLineText") IN ('quarter', 'quarters') THEN TRUNC((EXTRACT(MONTH FROM AGE((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END), (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END))) + EXTRACT(YEAR FROM AGE((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END), (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END))) * 12) / 3.0)
      WHEN LOWER("t"."SingleLineText") IN ('year', 'years') THEN TRUNC(EXTRACT(YEAR FROM AGE((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END), (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END))))
      WHEN LOWER("t"."SingleLineText") IN ('day', 'days') THEN TRUNC((EXTRACT(EPOCH FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)))) / 86400)
      ELSE NULL::double precision
    END) END))::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {SingleSelect})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'DatetimeDiffUnitField' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "DATETIME_DIFF("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {User})",
  "funcId": "DatetimeDiffUnitField",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_datetime_diff_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_datetime_diff_unit' ELSE (NULL::double precision)::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "FROMNOW({Attachment}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "FROMNOW({AutoNumber}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "00000",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - to_timestamp(("t"."AutoNumber")::double precision)))) / 86400)",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "FROMNOW({Button}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "FROMNOW({Checkbox}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "FROMNOW({ConditionalLookupType}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END)))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "FROMNOW({ConditionalRollupType}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - to_timestamp(("t"."ConditionalRollupType")::double precision)))) / 86400)",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "FROMNOW({CreatedBy}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "FROMNOW({CreatedTime}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - ("t"."CreatedTime")::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "FROMNOW({Date}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "-00",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - ("t"."Date")::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "FROMNOW({FormulaType}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "00000",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - to_timestamp((10)::double precision)))) / 86400)",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "FROMNOW({LastModifiedBy}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "FROMNOW({LastModifiedTime}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - ("t"."LastModifiedTime")::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "FROMNOW({LinkType}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "FROMNOW({LongText}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "FROMNOW({LookupType}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END)))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "FROMNOW({MultipleSelect}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "FROMNOW({Number}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "00000",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - to_timestamp(("t"."Number")::double precision)))) / 86400)",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "FROMNOW({Rating}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "00000",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - to_timestamp(("t"."Rating")::double precision)))) / 86400)",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "FROMNOW({RollupType}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - to_timestamp(("t"."RollupType")::double precision)))) / 86400)",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "FROMNOW({SingleLineText}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "FROMNOW({SingleSelect}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'FromNow' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "FROMNOW({User}, "day")",
  "funcId": "FromNow",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'Second' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "SECOND({Attachment})",
  "funcId": "Second",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 2 > 'Second' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "SECOND({AutoNumber})",
  "funcId": "Second",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "1",
  "sql": "EXTRACT(SECOND FROM (to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 2 > 'Second' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "SECOND({Button})",
  "funcId": "Second",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(SECOND FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 2 > 'Second' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "SECOND({Checkbox})",
  "funcId": "Second",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(SECOND FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 2 > 'Second' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "SECOND({ConditionalLookupType})",
  "funcId": "Second",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(SECOND FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 2 > 'Second' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "SECOND({ConditionalRollupType})",
  "funcId": "Second",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(SECOND FROM (to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 2 > 'Second' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "SECOND({CreatedBy})",
  "funcId": "Second",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(SECOND FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 2 > 'Second' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "SECOND({CreatedTime})",
  "funcId": "Second",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(SECOND FROM (("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 2 > 'Second' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "SECOND({Date})",
  "funcId": "Second",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(SECOND FROM (("t"."Date")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 2 > 'Second' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "SECOND({FormulaType})",
  "funcId": "Second",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "10",
  "sql": "EXTRACT(SECOND FROM (to_timestamp((10)::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 2 > 'Second' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "SECOND({LastModifiedBy})",
  "funcId": "Second",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(SECOND FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 2 > 'Second' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "SECOND({LastModifiedTime})",
  "funcId": "Second",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "EXTRACT(SECOND FROM (("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 2 > 'Second' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "SECOND({LinkType})",
  "funcId": "Second",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(SECOND FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 2 > 'Second' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "SECOND({LongText})",
  "funcId": "Second",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE EXTRACT(SECOND FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 2 > 'Second' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "SECOND({LookupType})",
  "funcId": "Second",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(SECOND FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 2 > 'Second' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "SECOND({MultipleSelect})",
  "funcId": "Second",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "[null, null]",
  "sql": "(SELECT jsonb_agg(to_jsonb((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE EXTRACT(SECOND FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::int END)) ORDER BY ord)
        FROM jsonb_array_elements(COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
      )",
}
`;

exports[`date functions batch 2 > 'Second' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "SECOND({Number})",
  "funcId": "Second",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "10",
  "sql": "EXTRACT(SECOND FROM (to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 2 > 'Second' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "SECOND({Rating})",
  "funcId": "Second",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "4",
  "sql": "EXTRACT(SECOND FROM (to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 2 > 'Second' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "SECOND({RollupType})",
  "funcId": "Second",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "EXTRACT(SECOND FROM (to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC')::int",
}
`;

exports[`date functions batch 2 > 'Second' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "SECOND({SingleLineText})",
  "funcId": "Second",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE EXTRACT(SECOND FROM ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 2 > 'Second' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "SECOND({SingleSelect})",
  "funcId": "Second",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE EXTRACT(SECOND FROM (NULL::timestamptz) AT TIME ZONE 'UTC')::int END))::text END",
}
`;

exports[`date functions batch 2 > 'Second' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "SECOND({User})",
  "funcId": "Second",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::int)::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "TONOW({Attachment}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "TONOW({AutoNumber}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "00000",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - to_timestamp(("t"."AutoNumber")::double precision)))) / 86400)",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "TONOW({Button}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "TONOW({Checkbox}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "TONOW({ConditionalLookupType}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END)))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "TONOW({ConditionalRollupType}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - to_timestamp(("t"."ConditionalRollupType")::double precision)))) / 86400)",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "TONOW({CreatedBy}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "TONOW({CreatedTime}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - ("t"."CreatedTime")::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "TONOW({Date}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "-00",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - ("t"."Date")::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "TONOW({FormulaType}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "00000",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - to_timestamp((10)::double precision)))) / 86400)",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "TONOW({LastModifiedBy}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "TONOW({LastModifiedTime}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - ("t"."LastModifiedTime")::timestamptz))) / 86400)",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "TONOW({LinkType}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "TONOW({LongText}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "TONOW({LookupType}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END)))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "TONOW({MultipleSelect}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "TONOW({Number}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "00000",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - to_timestamp(("t"."Number")::double precision)))) / 86400)",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "TONOW({Rating}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "00000",
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - to_timestamp(("t"."Rating")::double precision)))) / 86400)",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "TONOW({RollupType}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "TRUNC((EXTRACT(EPOCH FROM (NOW() - to_timestamp(("t"."RollupType")::double precision)))) / 86400)",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "TONOW({SingleLineText}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "TONOW({SingleSelect}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'ToNow' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "TONOW({User}, "day")",
  "funcId": "ToNow",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE ((CASE WHEN TRUE THEN NULL ELSE TRUNC((EXTRACT(EPOCH FROM (NOW() - NULL::timestamptz))) / 86400) END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "WORKDAY({Attachment}, 2)",
  "funcId": "Workday",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "WORKDAY({AutoNumber}, 2)",
  "funcId": "Workday",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "1970-01-03 00:00:00",
  "sql": "((to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision",
}
`;

exports[`date functions batch 2 > 'Workday' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "WORKDAY({Button}, 2)",
  "funcId": "Workday",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "WORKDAY({Checkbox}, 2)",
  "funcId": "Workday",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "WORKDAY({ConditionalLookupType}, 2)",
  "funcId": "Workday",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END)) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "WORKDAY({ConditionalRollupType}, 2)",
  "funcId": "Workday",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "((to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision",
}
`;

exports[`date functions batch 2 > 'Workday' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "WORKDAY({CreatedBy}, 2)",
  "funcId": "Workday",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "WORKDAY({CreatedTime}, 2)",
  "funcId": "Workday",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0000-00-00 00:00:00.000",
  "sql": "((("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision",
}
`;

exports[`date functions batch 2 > 'Workday' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "WORKDAY({Date}, 2)",
  "funcId": "Workday",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "2024-02-05 00:00:00",
  "sql": "((("t"."Date")::timestamptz) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision",
}
`;

exports[`date functions batch 2 > 'Workday' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "WORKDAY({FormulaType}, 2)",
  "funcId": "Workday",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "1970-01-03 00:00:00",
  "sql": "((to_timestamp((10)::double precision)) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision",
}
`;

exports[`date functions batch 2 > 'Workday' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "WORKDAY({LastModifiedBy}, 2)",
  "funcId": "Workday",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "WORKDAY({LastModifiedTime}, 2)",
  "funcId": "Workday",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0000-00-00 00:00:00.000",
  "sql": "((("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision",
}
`;

exports[`date functions batch 2 > 'Workday' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "WORKDAY({LinkType}, 2)",
  "funcId": "Workday",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "WORKDAY({LongText}, 2)",
  "funcId": "Workday",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "WORKDAY({LookupType}, 2)",
  "funcId": "Workday",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END)) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "WORKDAY({MultipleSelect}, 2)",
  "funcId": "Workday",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "WORKDAY({Number}, 2)",
  "funcId": "Workday",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "1970-01-03 00:00:00",
  "sql": "((to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision",
}
`;

exports[`date functions batch 2 > 'Workday' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "WORKDAY({Rating}, 2)",
  "funcId": "Workday",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "1970-01-03 00:00:00",
  "sql": "((to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision",
}
`;

exports[`date functions batch 2 > 'Workday' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "WORKDAY({RollupType}, 2)",
  "funcId": "Workday",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "((to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision",
}
`;

exports[`date functions batch 2 > 'Workday' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "WORKDAY({SingleLineText}, 2)",
  "funcId": "Workday",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "WORKDAY({SingleSelect}, 2)",
  "funcId": "Workday",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 2 > 'Workday' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "WORKDAY({User}, 2)",
  "funcId": "Workday",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday' END ELSE ((CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date + INTERVAL '1 day' * (2)::double precision END))::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "DATE_ADD({Attachment}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "DATE_ADD({AutoNumber}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "1970-01-02 00:00:01+00",
  "sql": "to_timestamp(("t"."AutoNumber")::double precision) + ((1)::double precision) * INTERVAL '1 day'",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "DATE_ADD({Button}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "DATE_ADD({Checkbox}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "DATE_ADD({ConditionalLookupType}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "DATE_ADD({ConditionalRollupType}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "to_timestamp(("t"."ConditionalRollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day'",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "DATE_ADD({CreatedBy}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "DATE_ADD({CreatedTime}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0000-00-00 00:00:00.000+00",
  "sql": "("t"."CreatedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day'",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "DATE_ADD({Date}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "2024-02-04 00:00:00+00",
  "sql": "("t"."Date")::timestamptz + ((1)::double precision) * INTERVAL '1 day'",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "DATE_ADD({FormulaType}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "1970-01-02 00:00:10+00",
  "sql": "to_timestamp((10)::double precision) + ((1)::double precision) * INTERVAL '1 day'",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "DATE_ADD({LastModifiedBy}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "DATE_ADD({LastModifiedTime}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0000-00-00 00:00:00.000+00",
  "sql": "("t"."LastModifiedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day'",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "DATE_ADD({LinkType}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "DATE_ADD({LongText}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "DATE_ADD({LookupType}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "DATE_ADD({MultipleSelect}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "DATE_ADD({Number}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "1970-01-02 00:00:10+00",
  "sql": "to_timestamp(("t"."Number")::double precision) + ((1)::double precision) * INTERVAL '1 day'",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "DATE_ADD({Rating}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "1970-01-02 00:00:04+00",
  "sql": "to_timestamp(("t"."Rating")::double precision) + ((1)::double precision) * INTERVAL '1 day'",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "DATE_ADD({RollupType}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "to_timestamp(("t"."RollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day'",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "DATE_ADD({SingleLineText}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "DATE_ADD({SingleSelect}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 3 > 'DateAdd' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "DATE_ADD({User}, 1, "day")",
  "funcId": "DateAdd",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "IS_AFTER(DATE_ADD({Attachment}, 1, "day"), {Attachment})",
  "funcId": "IsAfter",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v))
      ELSE (COALESCE((NULL::timestamptz)::text, '') > COALESCE((SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe), ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "IS_AFTER(DATE_ADD({AutoNumber}, 1, "day"), {AutoNumber})",
  "funcId": "IsAfter",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (to_timestamp(("t"."AutoNumber")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) OR ((to_timestamp(("t"."AutoNumber")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text IS NULL)) AND ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT ("t"."AutoNumber")::text AS val) AS v) OR (("t"."AutoNumber")::text IS NULL)) THEN (COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (to_timestamp(("t"."AutoNumber")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v), 0) > COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT ("t"."AutoNumber")::text AS val) AS v), 0))
      ELSE (COALESCE((to_timestamp(("t"."AutoNumber")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text, '') > COALESCE(("t"."AutoNumber")::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "IS_AFTER(DATE_ADD({Button}, 1, "day"), {Button})",
  "funcId": "IsAfter",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT COALESCE(("t"."Button")::jsonb->>'title', ("t"."Button")::jsonb->>'name', ("t"."Button")::jsonb #>> '{}') AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT COALESCE(("t"."Button")::jsonb->>'title', ("t"."Button")::jsonb->>'name', ("t"."Button")::jsonb #>> '{}') AS val) AS v))
      ELSE (COALESCE((NULL::timestamptz)::text, '') > COALESCE(COALESCE(("t"."Button")::jsonb->>'title', ("t"."Button")::jsonb->>'name', ("t"."Button")::jsonb #>> '{}'), ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "IS_AFTER(DATE_ADD({Checkbox}, 1, "day"), {Checkbox})",
  "funcId": "IsAfter",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT ("t"."Checkbox")::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT ("t"."Checkbox")::text AS val) AS v))
      ELSE (COALESCE((NULL::timestamptz)::text, '') > COALESCE(("t"."Checkbox")::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "IS_AFTER(DATE_ADD({ConditionalLookupType}, 1, "day"), {ConditionalLookupType})",
  "funcId": "IsAfter",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": "false",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v))
      ELSE (COALESCE(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text, '') > COALESCE((SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp), ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "IS_AFTER(DATE_ADD({ConditionalRollupType}, 1, "day"), {ConditionalRollupType})",
  "funcId": "IsAfter",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "false",
  "sql": "(CASE
      WHEN ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (to_timestamp(("t"."ConditionalRollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) OR ((to_timestamp(("t"."ConditionalRollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text IS NULL)) AND ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT ("t"."ConditionalRollupType")::text AS val) AS v) OR (("t"."ConditionalRollupType")::text IS NULL)) THEN (COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (to_timestamp(("t"."ConditionalRollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v), 0) > COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT ("t"."ConditionalRollupType")::text AS val) AS v), 0))
      ELSE (COALESCE((to_timestamp(("t"."ConditionalRollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text, '') > COALESCE(("t"."ConditionalRollupType")::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "IS_AFTER(DATE_ADD({CreatedBy}, 1, "day"), {CreatedBy})",
  "funcId": "IsAfter",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'object' THEN COALESCE(("t"."CreatedBy")::jsonb->>'title', ("t"."CreatedBy")::jsonb->>'name', ("t"."CreatedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."CreatedBy")::jsonb #>> '{}'
  END) AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'object' THEN COALESCE(("t"."CreatedBy")::jsonb->>'title', ("t"."CreatedBy")::jsonb->>'name', ("t"."CreatedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."CreatedBy")::jsonb #>> '{}'
  END) AS val) AS v))
      ELSE (COALESCE((NULL::timestamptz)::text, '') > COALESCE((CASE
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'object' THEN COALESCE(("t"."CreatedBy")::jsonb->>'title', ("t"."CreatedBy")::jsonb->>'name', ("t"."CreatedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."CreatedBy")::jsonb #>> '{}'
  END), ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "IS_AFTER(DATE_ADD({CreatedTime}, 1, "day"), {CreatedTime})",
  "funcId": "IsAfter",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (("t"."CreatedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT TO_CHAR(("t"."CreatedTime")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI') AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (("t"."CreatedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT TO_CHAR(("t"."CreatedTime")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI') AS val) AS v))
      ELSE (COALESCE((("t"."CreatedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text, '') > COALESCE(TO_CHAR(("t"."CreatedTime")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI'), ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "IS_AFTER(DATE_ADD({Date}, 1, "day"), {Date})",
  "funcId": "IsAfter",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (("t"."Date")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT TO_CHAR(("t"."Date")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI') AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (("t"."Date")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT TO_CHAR(("t"."Date")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI') AS val) AS v))
      ELSE (COALESCE((("t"."Date")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text, '') > COALESCE(TO_CHAR(("t"."Date")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI'), ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "IS_AFTER(DATE_ADD({FormulaType}, 1, "day"), {FormulaType})",
  "funcId": "IsAfter",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (to_timestamp((10)::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) OR ((to_timestamp((10)::double precision) + ((1)::double precision) * INTERVAL '1 day')::text IS NULL)) AND ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (10)::text AS val) AS v) OR ((10)::text IS NULL)) THEN (COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (to_timestamp((10)::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v), 0) > COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (10)::text AS val) AS v), 0))
      ELSE (COALESCE((to_timestamp((10)::double precision) + ((1)::double precision) * INTERVAL '1 day')::text, '') > COALESCE((10)::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "IS_AFTER(DATE_ADD({LastModifiedBy}, 1, "day"), {LastModifiedBy})",
  "funcId": "IsAfter",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'object' THEN COALESCE(("t"."LastModifiedBy")::jsonb->>'title', ("t"."LastModifiedBy")::jsonb->>'name', ("t"."LastModifiedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."LastModifiedBy")::jsonb #>> '{}'
  END) AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'object' THEN COALESCE(("t"."LastModifiedBy")::jsonb->>'title', ("t"."LastModifiedBy")::jsonb->>'name', ("t"."LastModifiedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."LastModifiedBy")::jsonb #>> '{}'
  END) AS val) AS v))
      ELSE (COALESCE((NULL::timestamptz)::text, '') > COALESCE((CASE
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'object' THEN COALESCE(("t"."LastModifiedBy")::jsonb->>'title', ("t"."LastModifiedBy")::jsonb->>'name', ("t"."LastModifiedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."LastModifiedBy")::jsonb #>> '{}'
  END), ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "IS_AFTER(DATE_ADD({LastModifiedTime}, 1, "day"), {LastModifiedTime})",
  "funcId": "IsAfter",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (("t"."LastModifiedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT TO_CHAR(("t"."LastModifiedTime")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI') AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (("t"."LastModifiedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT TO_CHAR(("t"."LastModifiedTime")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI') AS val) AS v))
      ELSE (COALESCE((("t"."LastModifiedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text, '') > COALESCE(TO_CHAR(("t"."LastModifiedTime")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI'), ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "IS_AFTER(DATE_ADD({LinkType}, 1, "day"), {LinkType})",
  "funcId": "IsAfter",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT COALESCE(("t"."LinkType")::jsonb->>'title', ("t"."LinkType")::jsonb->>'name', ("t"."LinkType")::jsonb #>> '{}') AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT COALESCE(("t"."LinkType")::jsonb->>'title', ("t"."LinkType")::jsonb->>'name', ("t"."LinkType")::jsonb #>> '{}') AS val) AS v))
      ELSE (COALESCE((NULL::timestamptz)::text, '') > COALESCE(COALESCE(("t"."LinkType")::jsonb->>'title', ("t"."LinkType")::jsonb->>'name', ("t"."LinkType")::jsonb #>> '{}'), ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "IS_AFTER(DATE_ADD({LongText}, 1, "day"), {LongText})",
  "funcId": "IsAfter",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT "t"."LongText" AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT "t"."LongText" AS val) AS v))
      ELSE (COALESCE(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text, '') > COALESCE("t"."LongText", ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "IS_AFTER(DATE_ADD({LookupType}, 1, "day"), {LookupType})",
  "funcId": "IsAfter",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": "false",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v))
      ELSE (COALESCE(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text, '') > COALESCE((SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp), ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "IS_AFTER(DATE_ADD({MultipleSelect}, 1, "day"), {MultipleSelect})",
  "funcId": "IsAfter",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE fe.elem #>> '{}'
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE fe.elem #>> '{}'
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v))
      ELSE (COALESCE((NULL::timestamptz)::text, '') > COALESCE((SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE fe.elem #>> '{}'
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe), ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "IS_AFTER(DATE_ADD({Number}, 1, "day"), {Number})",
  "funcId": "IsAfter",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (to_timestamp(("t"."Number")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) OR ((to_timestamp(("t"."Number")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text IS NULL)) AND ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT ("t"."Number")::text AS val) AS v) OR (("t"."Number")::text IS NULL)) THEN (COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (to_timestamp(("t"."Number")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v), 0) > COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT ("t"."Number")::text AS val) AS v), 0))
      ELSE (COALESCE((to_timestamp(("t"."Number")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text, '') > COALESCE(("t"."Number")::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "IS_AFTER(DATE_ADD({Rating}, 1, "day"), {Rating})",
  "funcId": "IsAfter",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (to_timestamp(("t"."Rating")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) OR ((to_timestamp(("t"."Rating")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text IS NULL)) AND ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT ("t"."Rating")::text AS val) AS v) OR (("t"."Rating")::text IS NULL)) THEN (COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (to_timestamp(("t"."Rating")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v), 0) > COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT ("t"."Rating")::text AS val) AS v), 0))
      ELSE (COALESCE((to_timestamp(("t"."Rating")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text, '') > COALESCE(("t"."Rating")::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "IS_AFTER(DATE_ADD({RollupType}, 1, "day"), {RollupType})",
  "funcId": "IsAfter",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "false",
  "sql": "(CASE
      WHEN ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (to_timestamp(("t"."RollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) OR ((to_timestamp(("t"."RollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text IS NULL)) AND ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT ("t"."RollupType")::text AS val) AS v) OR (("t"."RollupType")::text IS NULL)) THEN (COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (to_timestamp(("t"."RollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v), 0) > COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT ("t"."RollupType")::text AS val) AS v), 0))
      ELSE (COALESCE((to_timestamp(("t"."RollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text, '') > COALESCE(("t"."RollupType")::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "IS_AFTER(DATE_ADD({SingleLineText}, 1, "day"), {SingleLineText})",
  "funcId": "IsAfter",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT "t"."SingleLineText" AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v))
      ELSE (COALESCE(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text, '') > COALESCE("t"."SingleLineText", ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "IS_AFTER(DATE_ADD({SingleSelect}, 1, "day"), {SingleSelect})",
  "funcId": "IsAfter",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT "t"."SingleSelect" AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT "t"."SingleSelect" AS val) AS v))
      ELSE (COALESCE((NULL::timestamptz)::text, '') > COALESCE("t"."SingleSelect", ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsAfter' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "IS_AFTER(DATE_ADD({User}, 1, "day"), {User})",
  "funcId": "IsAfter",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v) > (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v))
      ELSE (COALESCE((NULL::timestamptz)::text, '') > COALESCE((SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe), ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "IS_BEFORE({Attachment}, DATE_ADD({Attachment}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v))
      ELSE (COALESCE((SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe), '') < COALESCE((NULL::timestamptz)::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "IS_BEFORE({AutoNumber}, DATE_ADD({AutoNumber}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT ("t"."AutoNumber")::text AS val) AS v) OR (("t"."AutoNumber")::text IS NULL)) AND ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (to_timestamp(("t"."AutoNumber")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) OR ((to_timestamp(("t"."AutoNumber")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text IS NULL)) THEN (COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT ("t"."AutoNumber")::text AS val) AS v), 0) < COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (to_timestamp(("t"."AutoNumber")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v), 0))
      ELSE (COALESCE(("t"."AutoNumber")::text, '') < COALESCE((to_timestamp(("t"."AutoNumber")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "IS_BEFORE({Button}, DATE_ADD({Button}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT COALESCE(("t"."Button")::jsonb->>'title', ("t"."Button")::jsonb->>'name', ("t"."Button")::jsonb #>> '{}') AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT COALESCE(("t"."Button")::jsonb->>'title', ("t"."Button")::jsonb->>'name', ("t"."Button")::jsonb #>> '{}') AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v))
      ELSE (COALESCE(COALESCE(("t"."Button")::jsonb->>'title', ("t"."Button")::jsonb->>'name', ("t"."Button")::jsonb #>> '{}'), '') < COALESCE((NULL::timestamptz)::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "IS_BEFORE({Checkbox}, DATE_ADD({Checkbox}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT ("t"."Checkbox")::text AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT ("t"."Checkbox")::text AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v))
      ELSE (COALESCE(("t"."Checkbox")::text, '') < COALESCE((NULL::timestamptz)::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "IS_BEFORE({ConditionalLookupType}, DATE_ADD({ConditionalLookupType}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": "false",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v))
      ELSE (COALESCE((SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp), '') < COALESCE(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "IS_BEFORE({ConditionalRollupType}, DATE_ADD({ConditionalRollupType}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "false",
  "sql": "(CASE
      WHEN ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT ("t"."ConditionalRollupType")::text AS val) AS v) OR (("t"."ConditionalRollupType")::text IS NULL)) AND ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (to_timestamp(("t"."ConditionalRollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) OR ((to_timestamp(("t"."ConditionalRollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text IS NULL)) THEN (COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT ("t"."ConditionalRollupType")::text AS val) AS v), 0) < COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (to_timestamp(("t"."ConditionalRollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v), 0))
      ELSE (COALESCE(("t"."ConditionalRollupType")::text, '') < COALESCE((to_timestamp(("t"."ConditionalRollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "IS_BEFORE({CreatedBy}, DATE_ADD({CreatedBy}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'object' THEN COALESCE(("t"."CreatedBy")::jsonb->>'title', ("t"."CreatedBy")::jsonb->>'name', ("t"."CreatedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."CreatedBy")::jsonb #>> '{}'
  END) AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'object' THEN COALESCE(("t"."CreatedBy")::jsonb->>'title', ("t"."CreatedBy")::jsonb->>'name', ("t"."CreatedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."CreatedBy")::jsonb #>> '{}'
  END) AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v))
      ELSE (COALESCE((CASE
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'object' THEN COALESCE(("t"."CreatedBy")::jsonb->>'title', ("t"."CreatedBy")::jsonb->>'name', ("t"."CreatedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."CreatedBy")::jsonb #>> '{}'
  END), '') < COALESCE((NULL::timestamptz)::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "IS_BEFORE({CreatedTime}, DATE_ADD({CreatedTime}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT TO_CHAR(("t"."CreatedTime")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI') AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (("t"."CreatedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT TO_CHAR(("t"."CreatedTime")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI') AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (("t"."CreatedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v))
      ELSE (COALESCE(TO_CHAR(("t"."CreatedTime")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI'), '') < COALESCE((("t"."CreatedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "IS_BEFORE({Date}, DATE_ADD({Date}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT TO_CHAR(("t"."Date")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI') AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (("t"."Date")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT TO_CHAR(("t"."Date")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI') AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (("t"."Date")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v))
      ELSE (COALESCE(TO_CHAR(("t"."Date")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI'), '') < COALESCE((("t"."Date")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "IS_BEFORE({FormulaType}, DATE_ADD({FormulaType}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (10)::text AS val) AS v) OR ((10)::text IS NULL)) AND ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (to_timestamp((10)::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) OR ((to_timestamp((10)::double precision) + ((1)::double precision) * INTERVAL '1 day')::text IS NULL)) THEN (COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (10)::text AS val) AS v), 0) < COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (to_timestamp((10)::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v), 0))
      ELSE (COALESCE((10)::text, '') < COALESCE((to_timestamp((10)::double precision) + ((1)::double precision) * INTERVAL '1 day')::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "IS_BEFORE({LastModifiedBy}, DATE_ADD({LastModifiedBy}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'object' THEN COALESCE(("t"."LastModifiedBy")::jsonb->>'title', ("t"."LastModifiedBy")::jsonb->>'name', ("t"."LastModifiedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."LastModifiedBy")::jsonb #>> '{}'
  END) AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'object' THEN COALESCE(("t"."LastModifiedBy")::jsonb->>'title', ("t"."LastModifiedBy")::jsonb->>'name', ("t"."LastModifiedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."LastModifiedBy")::jsonb #>> '{}'
  END) AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v))
      ELSE (COALESCE((CASE
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'object' THEN COALESCE(("t"."LastModifiedBy")::jsonb->>'title', ("t"."LastModifiedBy")::jsonb->>'name', ("t"."LastModifiedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."LastModifiedBy")::jsonb #>> '{}'
  END), '') < COALESCE((NULL::timestamptz)::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "IS_BEFORE({LastModifiedTime}, DATE_ADD({LastModifiedTime}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT TO_CHAR(("t"."LastModifiedTime")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI') AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (("t"."LastModifiedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT TO_CHAR(("t"."LastModifiedTime")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI') AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (("t"."LastModifiedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v))
      ELSE (COALESCE(TO_CHAR(("t"."LastModifiedTime")::timestamptz AT TIME ZONE 'UTC', 'YYYY/MM/DD HH24:MI'), '') < COALESCE((("t"."LastModifiedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "IS_BEFORE({LinkType}, DATE_ADD({LinkType}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT COALESCE(("t"."LinkType")::jsonb->>'title', ("t"."LinkType")::jsonb->>'name', ("t"."LinkType")::jsonb #>> '{}') AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT COALESCE(("t"."LinkType")::jsonb->>'title', ("t"."LinkType")::jsonb->>'name', ("t"."LinkType")::jsonb #>> '{}') AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v))
      ELSE (COALESCE(COALESCE(("t"."LinkType")::jsonb->>'title', ("t"."LinkType")::jsonb->>'name', ("t"."LinkType")::jsonb #>> '{}'), '') < COALESCE((NULL::timestamptz)::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "IS_BEFORE({LongText}, DATE_ADD({LongText}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT "t"."LongText" AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT "t"."LongText" AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v))
      ELSE (COALESCE("t"."LongText", '') < COALESCE(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "IS_BEFORE({LookupType}, DATE_ADD({LookupType}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": "false",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v))
      ELSE (COALESCE((SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp), '') < COALESCE(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "IS_BEFORE({MultipleSelect}, DATE_ADD({MultipleSelect}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE fe.elem #>> '{}'
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE fe.elem #>> '{}'
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v))
      ELSE (COALESCE((SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE fe.elem #>> '{}'
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe), '') < COALESCE((NULL::timestamptz)::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "IS_BEFORE({Number}, DATE_ADD({Number}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT ("t"."Number")::text AS val) AS v) OR (("t"."Number")::text IS NULL)) AND ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (to_timestamp(("t"."Number")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) OR ((to_timestamp(("t"."Number")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text IS NULL)) THEN (COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT ("t"."Number")::text AS val) AS v), 0) < COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (to_timestamp(("t"."Number")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v), 0))
      ELSE (COALESCE(("t"."Number")::text, '') < COALESCE((to_timestamp(("t"."Number")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "IS_BEFORE({Rating}, DATE_ADD({Rating}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "true",
  "sql": "(CASE
      WHEN ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT ("t"."Rating")::text AS val) AS v) OR (("t"."Rating")::text IS NULL)) AND ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (to_timestamp(("t"."Rating")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) OR ((to_timestamp(("t"."Rating")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text IS NULL)) THEN (COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT ("t"."Rating")::text AS val) AS v), 0) < COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (to_timestamp(("t"."Rating")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v), 0))
      ELSE (COALESCE(("t"."Rating")::text, '') < COALESCE((to_timestamp(("t"."Rating")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "IS_BEFORE({RollupType}, DATE_ADD({RollupType}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "false",
  "sql": "(CASE
      WHEN ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT ("t"."RollupType")::text AS val) AS v) OR (("t"."RollupType")::text IS NULL)) AND ((SELECT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) FROM (SELECT (to_timestamp(("t"."RollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v) OR ((to_timestamp(("t"."RollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text IS NULL)) THEN (COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT ("t"."RollupType")::text AS val) AS v), 0) < COALESCE((SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (to_timestamp(("t"."RollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text AS val) AS v), 0))
      ELSE (COALESCE(("t"."RollupType")::text, '') < COALESCE((to_timestamp(("t"."RollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::text, ''))
    END)",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "IS_BEFORE({SingleLineText}, DATE_ADD({SingleLineText}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT "t"."SingleLineText" AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text AS val) AS v))
      ELSE (COALESCE("t"."SingleLineText", '') < COALESCE(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "IS_BEFORE({SingleSelect}, DATE_ADD({SingleSelect}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT "t"."SingleSelect" AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT "t"."SingleSelect" AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v))
      ELSE (COALESCE("t"."SingleSelect", '') < COALESCE((NULL::timestamptz)::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsBefore' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "IS_BEFORE({User}, DATE_ADD({User}, 1, "day"))",
  "funcId": "IsBefore",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_comparison' END ELSE ((CASE WHEN TRUE THEN NULL ELSE (CASE
      WHEN ((SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) AND (SELECT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp')) FROM (SELECT (NULL::timestamptz)::text AS val) AS v)) THEN ((SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) < (SELECT (CASE
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL
      END) FROM (SELECT (NULL::timestamptz)::text AS val) AS v))
      ELSE (COALESCE((SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe), '') < COALESCE((NULL::timestamptz)::text, ''))
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "IS_SAME({Attachment}, DATE_ADD({Attachment}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "IS_SAME({AutoNumber}, DATE_ADD({AutoNumber}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "false",
  "sql": "DATE_TRUNC('day', (to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC') = DATE_TRUNC('day', ((to_timestamp(("t"."AutoNumber")::double precision) + ((1)::double precision) * INTERVAL '1 day')::timestamptz) AT TIME ZONE 'UTC')",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "IS_SAME({Button}, DATE_ADD({Button}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "IS_SAME({Checkbox}, DATE_ADD({Checkbox}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "IS_SAME({ConditionalLookupType}, DATE_ADD({ConditionalLookupType}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_is_same' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN NULL ELSE DATE_TRUNC('day', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END)) AT TIME ZONE 'UTC') = DATE_TRUNC('day', (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::timestamptz) AT TIME ZONE 'UTC') END))::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "IS_SAME({ConditionalRollupType}, DATE_ADD({ConditionalRollupType}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "DATE_TRUNC('day', (to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC') = DATE_TRUNC('day', ((to_timestamp(("t"."ConditionalRollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::timestamptz) AT TIME ZONE 'UTC')",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "IS_SAME({CreatedBy}, DATE_ADD({CreatedBy}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "IS_SAME({CreatedTime}, DATE_ADD({CreatedTime}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "false",
  "sql": "DATE_TRUNC('day', (("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC') = DATE_TRUNC('day', ((("t"."CreatedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::timestamptz) AT TIME ZONE 'UTC')",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "IS_SAME({Date}, DATE_ADD({Date}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "false",
  "sql": "DATE_TRUNC('day', (("t"."Date")::timestamptz) AT TIME ZONE 'UTC') = DATE_TRUNC('day', ((("t"."Date")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::timestamptz) AT TIME ZONE 'UTC')",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "IS_SAME({FormulaType}, DATE_ADD({FormulaType}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "false",
  "sql": "DATE_TRUNC('day', (to_timestamp((10)::double precision)) AT TIME ZONE 'UTC') = DATE_TRUNC('day', ((to_timestamp((10)::double precision) + ((1)::double precision) * INTERVAL '1 day')::timestamptz) AT TIME ZONE 'UTC')",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "IS_SAME({LastModifiedBy}, DATE_ADD({LastModifiedBy}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "IS_SAME({LastModifiedTime}, DATE_ADD({LastModifiedTime}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "false",
  "sql": "DATE_TRUNC('day', (("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC') = DATE_TRUNC('day', ((("t"."LastModifiedTime")::timestamptz + ((1)::double precision) * INTERVAL '1 day')::timestamptz) AT TIME ZONE 'UTC')",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "IS_SAME({LinkType}, DATE_ADD({LinkType}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "IS_SAME({LongText}, DATE_ADD({LongText}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_is_same' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v)) THEN NULL ELSE DATE_TRUNC('day', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC') = DATE_TRUNC('day', (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::timestamptz) AT TIME ZONE 'UTC') END))::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "IS_SAME({LookupType}, DATE_ADD({LookupType}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_is_same' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN NULL ELSE DATE_TRUNC('day', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END)) AT TIME ZONE 'UTC') = DATE_TRUNC('day', (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::timestamptz) AT TIME ZONE 'UTC') END))::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "IS_SAME({MultipleSelect}, DATE_ADD({MultipleSelect}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "IS_SAME({Number}, DATE_ADD({Number}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "false",
  "sql": "DATE_TRUNC('day', (to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC') = DATE_TRUNC('day', ((to_timestamp(("t"."Number")::double precision) + ((1)::double precision) * INTERVAL '1 day')::timestamptz) AT TIME ZONE 'UTC')",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "IS_SAME({Rating}, DATE_ADD({Rating}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "false",
  "sql": "DATE_TRUNC('day', (to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC') = DATE_TRUNC('day', ((to_timestamp(("t"."Rating")::double precision) + ((1)::double precision) * INTERVAL '1 day')::timestamptz) AT TIME ZONE 'UTC')",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "IS_SAME({RollupType}, DATE_ADD({RollupType}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "DATE_TRUNC('day', (to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC') = DATE_TRUNC('day', ((to_timestamp(("t"."RollupType")::double precision) + ((1)::double precision) * INTERVAL '1 day')::timestamptz) AT TIME ZONE 'UTC')",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "IS_SAME({SingleLineText}, DATE_ADD({SingleLineText}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_is_same' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v)) THEN NULL ELSE DATE_TRUNC('day', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC') = DATE_TRUNC('day', (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day' END))::timestamptz) AT TIME ZONE 'UTC') END))::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "IS_SAME({SingleSelect}, DATE_ADD({SingleSelect}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSame' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "IS_SAME({User}, DATE_ADD({User}, 1, "day"), "day")",
  "funcId": "IsSame",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "IS_SAME({Attachment}, DATE_ADD({Attachment}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "IS_SAME({AutoNumber}, DATE_ADD({AutoNumber}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "IS_SAME({Button}, DATE_ADD({Button}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "IS_SAME({Checkbox}, DATE_ADD({Checkbox}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "IS_SAME({ConditionalLookupType}, DATE_ADD({ConditionalLookupType}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "IS_SAME({ConditionalRollupType}, DATE_ADD({ConditionalRollupType}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "IS_SAME({CreatedBy}, DATE_ADD({CreatedBy}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "IS_SAME({CreatedTime}, DATE_ADD({CreatedTime}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "IS_SAME({Date}, DATE_ADD({Date}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "IS_SAME({FormulaType}, DATE_ADD({FormulaType}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "IS_SAME({LastModifiedBy}, DATE_ADD({LastModifiedBy}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "IS_SAME({LastModifiedTime}, DATE_ADD({LastModifiedTime}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "IS_SAME({LinkType}, DATE_ADD({LinkType}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "IS_SAME({LongText}, DATE_ADD({LongText}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "IS_SAME({LookupType}, DATE_ADD({LookupType}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "IS_SAME({MultipleSelect}, DATE_ADD({MultipleSelect}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "IS_SAME({Number}, DATE_ADD({Number}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "IS_SAME({Rating}, DATE_ADD({Rating}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "IS_SAME({RollupType}, DATE_ADD({RollupType}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "IS_SAME({SingleLineText}, DATE_ADD({SingleLineText}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "IS_SAME({SingleSelect}, DATE_ADD({SingleSelect}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameInvalidUnit' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "IS_SAME({User}, DATE_ADD({User}, 1, "day"), "banana")",
  "funcId": "IsSameInvalidUnit",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {Attachment})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {AutoNumber})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {Button})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {Checkbox})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {ConditionalLookupType})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {ConditionalRollupType})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {CreatedBy})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {CreatedTime})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {Date})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {FormulaType})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {LastModifiedBy})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {LastModifiedTime})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {LinkType})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {LongText})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) OR (LOWER("t"."LongText") IS NULL OR LOWER("t"."LongText") NOT IN ('year', 'years', 'month', 'months', 'day', 'days'))) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (LOWER("t"."LongText") IS NULL OR LOWER("t"."LongText") NOT IN ('year', 'years', 'month', 'months', 'day', 'days')) THEN '#ERROR:ARG:invalid_is_same_unit' ELSE '#ERROR:ARG:invalid_is_same_unit' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) OR (LOWER("t"."LongText") IS NULL OR LOWER("t"."LongText") NOT IN ('year', 'years', 'month', 'months', 'day', 'days'))) THEN NULL ELSE (CASE
      WHEN LOWER("t"."LongText") IN ('year', 'years') THEN DATE_TRUNC('year', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END)) AT TIME ZONE 'UTC') = DATE_TRUNC('year', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)) AT TIME ZONE 'UTC')
      WHEN LOWER("t"."LongText") IN ('month', 'months') THEN DATE_TRUNC('month', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END)) AT TIME ZONE 'UTC') = DATE_TRUNC('month', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)) AT TIME ZONE 'UTC')
      WHEN LOWER("t"."LongText") IN ('day', 'days') THEN DATE_TRUNC('day', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END)) AT TIME ZONE 'UTC') = DATE_TRUNC('day', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)) AT TIME ZONE 'UTC')
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {LookupType})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {MultipleSelect})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {Number})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {Rating})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {RollupType})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {SingleLineText})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) OR (LOWER("t"."SingleLineText") IS NULL OR LOWER("t"."SingleLineText") NOT IN ('year', 'years', 'month', 'months', 'day', 'days'))) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (LOWER("t"."SingleLineText") IS NULL OR LOWER("t"."SingleLineText") NOT IN ('year', 'years', 'month', 'months', 'day', 'days')) THEN '#ERROR:ARG:invalid_is_same_unit' ELSE '#ERROR:ARG:invalid_is_same_unit' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) OR (LOWER("t"."SingleLineText") IS NULL OR LOWER("t"."SingleLineText") NOT IN ('year', 'years', 'month', 'months', 'day', 'days'))) THEN NULL ELSE (CASE
      WHEN LOWER("t"."SingleLineText") IN ('year', 'years') THEN DATE_TRUNC('year', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END)) AT TIME ZONE 'UTC') = DATE_TRUNC('year', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)) AT TIME ZONE 'UTC')
      WHEN LOWER("t"."SingleLineText") IN ('month', 'months') THEN DATE_TRUNC('month', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END)) AT TIME ZONE 'UTC') = DATE_TRUNC('month', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)) AT TIME ZONE 'UTC')
      WHEN LOWER("t"."SingleLineText") IN ('day', 'days') THEN DATE_TRUNC('day', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END)) AT TIME ZONE 'UTC') = DATE_TRUNC('day', ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-03T00:00:00Z' AS val) AS v) END)) AT TIME ZONE 'UTC')
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {SingleSelect})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'IsSameUnitField' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "IS_SAME("2024-01-02T00:00:00Z", "2024-01-03T00:00:00Z", {User})",
  "funcId": "IsSameUnitField",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_is_same_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_is_same_unit' ELSE (NULL::boolean)::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "WORKDAY_DIFF({Attachment}, DATE_ADD({Attachment}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (TRUE OR TRUE) THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN (TRUE OR TRUE) THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date - ((NULL::timestamptz) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "WORKDAY_DIFF({AutoNumber}, DATE_ADD({AutoNumber}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": null,
  "sql": "NULL::double precision",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "WORKDAY_DIFF({Button}, DATE_ADD({Button}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (TRUE OR TRUE) THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN (TRUE OR TRUE) THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date - ((NULL::timestamptz) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "WORKDAY_DIFF({Checkbox}, DATE_ADD({Checkbox}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN (TRUE OR TRUE) THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN (TRUE OR TRUE) THEN NULL ELSE (((NULL::timestamptz)::timestamptz) AT TIME ZONE 'UTC')::date - ((NULL::timestamptz) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "WORKDAY_DIFF({ConditionalLookupType}, DATE_ADD({ConditionalLookupType}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN NULL ELSE ((((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((2)::double precision) * INTERVAL '1 day' END))::timestamptz) AT TIME ZONE 'UTC')::date - (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END)) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "WORKDAY_DIFF({ConditionalRollupType}, DATE_ADD({ConditionalRollupType}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "NULL::double precision",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "WORKDAY_DIFF({CreatedBy}, DATE_ADD({CreatedBy}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (TRUE OR TRUE) THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN (TRUE OR TRUE) THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date - ((NULL::timestamptz) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "WORKDAY_DIFF({CreatedTime}, DATE_ADD({CreatedTime}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "(((("t"."CreatedTime")::timestamptz + ((2)::double precision) * INTERVAL '1 day')::timestamptz) AT TIME ZONE 'UTC')::date - ((("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC')::date",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "WORKDAY_DIFF({Date}, DATE_ADD({Date}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "2",
  "sql": "(((("t"."Date")::timestamptz + ((2)::double precision) * INTERVAL '1 day')::timestamptz) AT TIME ZONE 'UTC')::date - ((("t"."Date")::timestamptz) AT TIME ZONE 'UTC')::date",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "WORKDAY_DIFF({FormulaType}, DATE_ADD({FormulaType}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "NULL::double precision",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "WORKDAY_DIFF({LastModifiedBy}, DATE_ADD({LastModifiedBy}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (TRUE OR TRUE) THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN (TRUE OR TRUE) THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date - ((NULL::timestamptz) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "WORKDAY_DIFF({LastModifiedTime}, DATE_ADD({LastModifiedTime}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0",
  "sql": "(((("t"."LastModifiedTime")::timestamptz + ((2)::double precision) * INTERVAL '1 day')::timestamptz) AT TIME ZONE 'UTC')::date - ((("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC')::date",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "WORKDAY_DIFF({LinkType}, DATE_ADD({LinkType}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (TRUE OR TRUE) THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN (TRUE OR TRUE) THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date - ((NULL::timestamptz) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "WORKDAY_DIFF({LongText}, DATE_ADD({LongText}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v)) THEN NULL ELSE ((((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END) + ((2)::double precision) * INTERVAL '1 day' END))::timestamptz) AT TIME ZONE 'UTC')::date - (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "WORKDAY_DIFF({LookupType}, DATE_ADD({LookupType}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN NULL ELSE ((((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END) + ((2)::double precision) * INTERVAL '1 day' END))::timestamptz) AT TIME ZONE 'UTC')::date - (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END)) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "WORKDAY_DIFF({MultipleSelect}, DATE_ADD({MultipleSelect}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (TRUE OR TRUE) THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN (TRUE OR TRUE) THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date - ((NULL::timestamptz) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "WORKDAY_DIFF({Number}, DATE_ADD({Number}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": null,
  "sql": "NULL::double precision",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "WORKDAY_DIFF({Rating}, DATE_ADD({Rating}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": null,
  "sql": "NULL::double precision",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "WORKDAY_DIFF({RollupType}, DATE_ADD({RollupType}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "NULL::double precision",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "WORKDAY_DIFF({SingleLineText}, DATE_ADD({SingleLineText}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) OR (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v)) THEN NULL ELSE ((((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END) + ((2)::double precision) * INTERVAL '1 day' END))::timestamptz) AT TIME ZONE 'UTC')::date - (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "WORKDAY_DIFF({SingleSelect}, DATE_ADD({SingleSelect}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (TRUE OR TRUE) THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN (TRUE OR TRUE) THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date - ((NULL::timestamptz) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 3 > 'WorkdayDiff' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "WORKDAY_DIFF({User}, DATE_ADD({User}, 2, "day"))",
  "funcId": "WorkdayDiff",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (TRUE OR TRUE) THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_workday_diff' END ELSE ((CASE WHEN (TRUE OR TRUE) THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date - ((NULL::timestamptz) AT TIME ZONE 'UTC')::date END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {Attachment}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "2024-01-12 00:00:00+00",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) THEN CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_number' ELSE '#ERROR:TYPE:cannot_cast_to_number' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v)) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) END)) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {AutoNumber}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "2024-01-03 00:00:00+00",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + (("t"."AutoNumber")::double precision) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {Button}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_number",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_number' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {Checkbox}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "2024-01-03 00:00:00+00",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((CASE WHEN "t"."Checkbox" IS NULL THEN NULL WHEN "t"."Checkbox" THEN 1 ELSE 0 END)::double precision) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {ConditionalLookupType}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_number' ELSE '#ERROR:TYPE:cannot_cast_to_number' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
          WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
          ELSE lkp.elem #>> '{}'
        END
        FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END)) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {ConditionalRollupType}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + (("t"."ConditionalRollupType")::double precision) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {CreatedBy}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_number",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'object' THEN COALESCE(("t"."CreatedBy")::jsonb->>'title', ("t"."CreatedBy")::jsonb->>'name', ("t"."CreatedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."CreatedBy")::jsonb #>> '{}'
  END) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'object' THEN COALESCE(("t"."CreatedBy")::jsonb->>'title', ("t"."CreatedBy")::jsonb->>'name', ("t"."CreatedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."CreatedBy")::jsonb #>> '{}'
  END) AS val) AS v) THEN CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'object' THEN COALESCE(("t"."CreatedBy")::jsonb->>'title', ("t"."CreatedBy")::jsonb->>'name', ("t"."CreatedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."CreatedBy")::jsonb #>> '{}'
  END) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_number' ELSE '#ERROR:TYPE:cannot_cast_to_number' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'object' THEN COALESCE(("t"."CreatedBy")::jsonb->>'title', ("t"."CreatedBy")::jsonb->>'name', ("t"."CreatedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."CreatedBy")::jsonb #>> '{}'
  END) AS val) AS v)) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'object' THEN COALESCE(("t"."CreatedBy")::jsonb->>'title', ("t"."CreatedBy")::jsonb->>'name', ("t"."CreatedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."CreatedBy")::jsonb #>> '{}'
  END) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'object' THEN COALESCE(("t"."CreatedBy")::jsonb->>'title', ("t"."CreatedBy")::jsonb->>'name', ("t"."CreatedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."CreatedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."CreatedBy")::jsonb #>> '{}'
  END) AS val) AS v) END)) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {CreatedTime}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_datetime_to_number_date_add",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_datetime_to_number_date_add' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {Date}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_datetime_to_number_date_add",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_datetime_to_number_date_add' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {FormulaType}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "2024-01-12 00:00:00+00",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((10)::double precision) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {LastModifiedBy}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_number",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'object' THEN COALESCE(("t"."LastModifiedBy")::jsonb->>'title', ("t"."LastModifiedBy")::jsonb->>'name', ("t"."LastModifiedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."LastModifiedBy")::jsonb #>> '{}'
  END) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'object' THEN COALESCE(("t"."LastModifiedBy")::jsonb->>'title', ("t"."LastModifiedBy")::jsonb->>'name', ("t"."LastModifiedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."LastModifiedBy")::jsonb #>> '{}'
  END) AS val) AS v) THEN CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'object' THEN COALESCE(("t"."LastModifiedBy")::jsonb->>'title', ("t"."LastModifiedBy")::jsonb->>'name', ("t"."LastModifiedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."LastModifiedBy")::jsonb #>> '{}'
  END) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_number' ELSE '#ERROR:TYPE:cannot_cast_to_number' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'object' THEN COALESCE(("t"."LastModifiedBy")::jsonb->>'title', ("t"."LastModifiedBy")::jsonb->>'name', ("t"."LastModifiedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."LastModifiedBy")::jsonb #>> '{}'
  END) AS val) AS v)) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'object' THEN COALESCE(("t"."LastModifiedBy")::jsonb->>'title', ("t"."LastModifiedBy")::jsonb->>'name', ("t"."LastModifiedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."LastModifiedBy")::jsonb #>> '{}'
  END) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (CASE
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'object' THEN COALESCE(("t"."LastModifiedBy")::jsonb->>'title', ("t"."LastModifiedBy")::jsonb->>'name', ("t"."LastModifiedBy")::jsonb #>> '{}')
    WHEN jsonb_typeof(("t"."LastModifiedBy")::jsonb) = 'array' THEN NULL
    ELSE ("t"."LastModifiedBy")::jsonb #>> '{}'
  END) AS val) AS v) END)) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {LastModifiedTime}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_datetime_to_number_date_add",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_datetime_to_number_date_add' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {LinkType}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_number",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_number' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {LongText}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "2024-01-12 00:00:00+00",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."LongText" AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_number' ELSE '#ERROR:TYPE:cannot_cast_to_number' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."LongText" AS val) AS v)) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {LookupType}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_number' ELSE '#ERROR:TYPE:cannot_cast_to_number' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v)) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
        WHEN lkp.elem IS NULL OR jsonb_typeof(lkp.elem) = 'null' THEN NULL
        ELSE lkp.elem #>> '{}'
      END
      FROM (SELECT ((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp) -> 0) AS elem) AS lkp) AS val) AS v) END)) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {MultipleSelect}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "2024-01-12 00:00:00+00",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE fe.elem #>> '{}'
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE fe.elem #>> '{}'
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) THEN CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE fe.elem #>> '{}'
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_number' ELSE '#ERROR:TYPE:cannot_cast_to_number' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE fe.elem #>> '{}'
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v)) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE fe.elem #>> '{}'
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE fe.elem #>> '{}'
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) END)) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {Number}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "2024-01-12 00:00:00+00",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + (("t"."Number")::double precision) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {Rating}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "2024-01-06 00:00:00+00",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + (("t"."Rating")::double precision) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {RollupType}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + (("t"."RollupType")::double precision) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {SingleLineText}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "2024-01-12 00:00:00+00",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."SingleLineText" AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_number' ELSE '#ERROR:TYPE:cannot_cast_to_number' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."SingleLineText" AS val) AS v)) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {SingleSelect}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "2024-01-12 00:00:00+00",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."SingleSelect" AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."SingleSelect" AS val) AS v) THEN CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."SingleSelect" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_number' ELSE '#ERROR:TYPE:cannot_cast_to_number' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."SingleSelect" AS val) AS v)) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT "t"."SingleSelect" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT "t"."SingleSelect" AS val) AS v) END)) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddCountField' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", {User}, "day")",
  "funcId": "DateAddCountField",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v)) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) THEN CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_number' ELSE '#ERROR:TYPE:cannot_cast_to_number' END ELSE '#ERROR:TYPE:invalid_date_add' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v)) THEN NULL ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((CASE WHEN (SELECT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NOT (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric'))) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NULL THEN NULL
        WHEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)') IS NOT NULL AND NOT (NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') IS NOT NULL AND NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') ~ '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)[eE][+-]?\\d+') AND __teable_input_is_valid(SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'), 'numeric')) THEN (SUBSTRING(NULLIF(REGEXP_REPLACE(BTRIM((v.val)::text), '[,\\s]', '', 'g'), '') FROM '^([+-]?\\d+\\.?\\d*|[+-]?\\d*\\.\\d+)'))::double precision
        ELSE NULL
      END) FROM (SELECT (SELECT CASE
      WHEN fe.elem IS NULL OR jsonb_typeof(fe.elem) = 'null' THEN NULL
      ELSE COALESCE(fe.elem->>'title', fe.elem->>'name', fe.elem #>> '{}')
    END
    FROM (SELECT (COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb) -> 0) AS elem) AS fe) AS val) AS v) END)) * INTERVAL '1 day' END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "DATE_ADD({Attachment}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "DATE_ADD({AutoNumber}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "DATE_ADD({Button}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "DATE_ADD({Checkbox}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "DATE_ADD({ConditionalLookupType}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "DATE_ADD({ConditionalRollupType}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "DATE_ADD({CreatedBy}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "DATE_ADD({CreatedTime}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "DATE_ADD({Date}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "DATE_ADD({FormulaType}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "DATE_ADD({LastModifiedBy}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "DATE_ADD({LastModifiedTime}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "DATE_ADD({LinkType}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "DATE_ADD({LongText}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "DATE_ADD({LookupType}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "DATE_ADD({MultipleSelect}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "DATE_ADD({Number}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "DATE_ADD({Rating}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "DATE_ADD({RollupType}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "DATE_ADD({SingleLineText}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "DATE_ADD({SingleSelect}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddInvalidUnit' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "DATE_ADD({User}, 1, "banana")",
  "funcId": "DateAddInvalidUnit",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {Attachment})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {AutoNumber})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {Button})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {Checkbox})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {ConditionalLookupType})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {ConditionalRollupType})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {CreatedBy})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {CreatedTime})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {Date})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {FormulaType})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {LastModifiedBy})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {LastModifiedTime})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {LinkType})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {LongText})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (LOWER("t"."LongText") IS NULL OR LOWER("t"."LongText") NOT IN ('year', 'years', 'quarter', 'quarters', 'month', 'months', 'week', 'weeks', 'day', 'days', 'hour', 'hours', 'minute', 'minutes', 'second', 'seconds'))) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (LOWER("t"."LongText") IS NULL OR LOWER("t"."LongText") NOT IN ('year', 'years', 'quarter', 'quarters', 'month', 'months', 'week', 'weeks', 'day', 'days', 'hour', 'hours', 'minute', 'minutes', 'second', 'seconds')) THEN '#ERROR:ARG:invalid_date_add_unit' ELSE '#ERROR:ARG:invalid_date_add_unit' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (LOWER("t"."LongText") IS NULL OR LOWER("t"."LongText") NOT IN ('year', 'years', 'quarter', 'quarters', 'month', 'months', 'week', 'weeks', 'day', 'days', 'hour', 'hours', 'minute', 'minutes', 'second', 'seconds'))) THEN NULL ELSE (CASE
      WHEN LOWER("t"."LongText") IN ('year', 'years') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 year'
      WHEN LOWER("t"."LongText") IN ('quarter', 'quarters') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '3 month'
      WHEN LOWER("t"."LongText") IN ('month', 'months') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 month'
      WHEN LOWER("t"."LongText") IN ('week', 'weeks') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 week'
      WHEN LOWER("t"."LongText") IN ('day', 'days') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day'
      WHEN LOWER("t"."LongText") IN ('hour', 'hours') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 hour'
      WHEN LOWER("t"."LongText") IN ('minute', 'minutes') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 minute'
      WHEN LOWER("t"."LongText") IN ('second', 'seconds') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 second'
      ELSE NULL::timestamptz
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {LookupType})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {MultipleSelect})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {Number})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {Rating})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {RollupType})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {SingleLineText})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (LOWER("t"."SingleLineText") IS NULL OR LOWER("t"."SingleLineText") NOT IN ('year', 'years', 'quarter', 'quarters', 'month', 'months', 'week', 'weeks', 'day', 'days', 'hour', 'hours', 'minute', 'minutes', 'second', 'seconds'))) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END WHEN (LOWER("t"."SingleLineText") IS NULL OR LOWER("t"."SingleLineText") NOT IN ('year', 'years', 'quarter', 'quarters', 'month', 'months', 'week', 'weeks', 'day', 'days', 'hour', 'hours', 'minute', 'minutes', 'second', 'seconds')) THEN '#ERROR:ARG:invalid_date_add_unit' ELSE '#ERROR:ARG:invalid_date_add_unit' END ELSE ((CASE WHEN ((SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) OR (LOWER("t"."SingleLineText") IS NULL OR LOWER("t"."SingleLineText") NOT IN ('year', 'years', 'quarter', 'quarters', 'month', 'months', 'week', 'weeks', 'day', 'days', 'hour', 'hours', 'minute', 'minutes', 'second', 'seconds'))) THEN NULL ELSE (CASE
      WHEN LOWER("t"."SingleLineText") IN ('year', 'years') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 year'
      WHEN LOWER("t"."SingleLineText") IN ('quarter', 'quarters') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '3 month'
      WHEN LOWER("t"."SingleLineText") IN ('month', 'months') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 month'
      WHEN LOWER("t"."SingleLineText") IN ('week', 'weeks') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 week'
      WHEN LOWER("t"."SingleLineText") IN ('day', 'days') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 day'
      WHEN LOWER("t"."SingleLineText") IN ('hour', 'hours') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 hour'
      WHEN LOWER("t"."SingleLineText") IN ('minute', 'minutes') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 minute'
      WHEN LOWER("t"."SingleLineText") IN ('second', 'seconds') THEN (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT '2024-01-02T00:00:00Z' AS val) AS v) END) + ((1)::double precision) * INTERVAL '1 second'
      ELSE NULL::timestamptz
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {SingleSelect})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DateAddUnitField' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "DATE_ADD("2024-01-02T00:00:00Z", 1, {User})",
  "funcId": "DateAddUnitField",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:ARG:invalid_date_add_unit",
  "sql": "CASE WHEN TRUE THEN '#ERROR:ARG:invalid_date_add_unit' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "DATESTR({Attachment})",
  "funcId": "Datestr",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::date::text END), ', ' ORDER BY ord)
      FROM jsonb_array_elements(COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "DATESTR({AutoNumber})",
  "funcId": "Datestr",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "1970-01-01",
  "sql": "((to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC')::date::text",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "DATESTR({Button})",
  "funcId": "Datestr",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date::text END) END",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "DATESTR({Checkbox})",
  "funcId": "Datestr",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE (CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date::text END) END",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "DATESTR({ConditionalLookupType})",
  "funcId": "Datestr",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::date::text END), ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "DATESTR({ConditionalRollupType})",
  "funcId": "Datestr",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "((to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC')::date::text",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "DATESTR({CreatedBy})",
  "funcId": "Datestr",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date::text END) END",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "DATESTR({CreatedTime})",
  "funcId": "Datestr",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0000-00-00",
  "sql": "((("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC')::date::text",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "DATESTR({Date})",
  "funcId": "Datestr",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "2024-02-03",
  "sql": "((("t"."Date")::timestamptz) AT TIME ZONE 'UTC')::date::text",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "DATESTR({FormulaType})",
  "funcId": "Datestr",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "1970-01-01",
  "sql": "((to_timestamp((10)::double precision)) AT TIME ZONE 'UTC')::date::text",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "DATESTR({LastModifiedBy})",
  "funcId": "Datestr",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date::text END) END",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "DATESTR({LastModifiedTime})",
  "funcId": "Datestr",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0000-00-00",
  "sql": "((("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC')::date::text",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "DATESTR({LinkType})",
  "funcId": "Datestr",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date::text END) END",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "DATESTR({LongText})",
  "funcId": "Datestr",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC')::date::text END) END",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "DATESTR({LookupType})",
  "funcId": "Datestr",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::date::text END), ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "DATESTR({MultipleSelect})",
  "funcId": "Datestr",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::date::text END), ', ' ORDER BY ord)
      FROM jsonb_array_elements(COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "DATESTR({Number})",
  "funcId": "Datestr",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "1970-01-01",
  "sql": "((to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC')::date::text",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "DATESTR({Rating})",
  "funcId": "Datestr",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "1970-01-01",
  "sql": "((to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC')::date::text",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "DATESTR({RollupType})",
  "funcId": "Datestr",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "((to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC')::date::text",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "DATESTR({SingleLineText})",
  "funcId": "Datestr",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC')::date::text END) END",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "DATESTR({SingleSelect})",
  "funcId": "Datestr",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::date::text END) END",
}
`;

exports[`date functions batch 4 > 'Datestr' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "DATESTR({User})",
  "funcId": "Datestr",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::date::text END), ', ' ORDER BY ord)
      FROM jsonb_array_elements(COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "DATETIME_FORMAT({Attachment}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'MI') END), ', ' ORDER BY ord)
      FROM jsonb_array_elements(COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "DATETIME_FORMAT({AutoNumber}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "1970-01-01 00:00",
  "sql": "TO_CHAR((to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC', 'MI')",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "DATETIME_FORMAT({Button}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_datetime_format' END ELSE (CASE WHEN TRUE THEN NULL ELSE TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'MI') END) END",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "DATETIME_FORMAT({Checkbox}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE '#ERROR:TYPE:invalid_datetime_format' END ELSE (CASE WHEN TRUE THEN NULL ELSE TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'MI') END) END",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "DATETIME_FORMAT({ConditionalLookupType}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'MI') END), ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "DATETIME_FORMAT({ConditionalRollupType}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "TO_CHAR((to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC', 'MI')",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "DATETIME_FORMAT({CreatedBy}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_datetime_format' END ELSE (CASE WHEN TRUE THEN NULL ELSE TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'MI') END) END",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "DATETIME_FORMAT({CreatedTime}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0000-00-00 00:00",
  "sql": "TO_CHAR((("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC', 'MI')",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "DATETIME_FORMAT({Date}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "2024-02-03 00:00",
  "sql": "TO_CHAR((("t"."Date")::timestamptz) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((("t"."Date")::timestamptz) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((("t"."Date")::timestamptz) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((("t"."Date")::timestamptz) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((("t"."Date")::timestamptz) AT TIME ZONE 'UTC', 'MI')",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "DATETIME_FORMAT({FormulaType}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "1970-01-01 00:00",
  "sql": "TO_CHAR((to_timestamp((10)::double precision)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((to_timestamp((10)::double precision)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((to_timestamp((10)::double precision)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((to_timestamp((10)::double precision)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((to_timestamp((10)::double precision)) AT TIME ZONE 'UTC', 'MI')",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "DATETIME_FORMAT({LastModifiedBy}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_datetime_format' END ELSE (CASE WHEN TRUE THEN NULL ELSE TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'MI') END) END",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "DATETIME_FORMAT({LastModifiedTime}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0000-00-00 00:00",
  "sql": "TO_CHAR((("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC', 'MI')",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "DATETIME_FORMAT({LinkType}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_datetime_format' END ELSE (CASE WHEN TRUE THEN NULL ELSE TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'MI') END) END",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "DATETIME_FORMAT({LongText}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_datetime_format' END ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC', 'MI') END) END",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "DATETIME_FORMAT({LookupType}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'MI') END), ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "DATETIME_FORMAT({MultipleSelect}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'MI') END), ', ' ORDER BY ord)
      FROM jsonb_array_elements(COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "DATETIME_FORMAT({Number}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "1970-01-01 00:00",
  "sql": "TO_CHAR((to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC', 'MI')",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "DATETIME_FORMAT({Rating}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "1970-01-01 00:00",
  "sql": "TO_CHAR((to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC', 'MI')",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "DATETIME_FORMAT({RollupType}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "TO_CHAR((to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC', 'MI')",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "DATETIME_FORMAT({SingleLineText}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE '#ERROR:TYPE:invalid_datetime_format' END ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC', 'MI') END) END",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "DATETIME_FORMAT({SingleSelect}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:invalid_datetime_format' END ELSE (CASE WHEN TRUE THEN NULL ELSE TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR((NULL::timestamptz) AT TIME ZONE 'UTC', 'MI') END) END",
}
`;

exports[`date functions batch 4 > 'DatetimeFormat' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "DATETIME_FORMAT({User}, "YYYY-MM-DD HH:mm")",
  "funcId": "DatetimeFormat",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'YYYY') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'MM') || '-' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'DD') || ' ' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'HH24') || ':' || TO_CHAR(((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC', 'MI') END), ', ' ORDER BY ord)
      FROM jsonb_array_elements(COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "DATETIME_PARSE({Attachment})",
  "funcId": "DatetimeParse",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "DATETIME_PARSE({AutoNumber})",
  "funcId": "DatetimeParse",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (("t"."AutoNumber")::text IS NOT NULL AND NOT (__teable_input_is_valid(("t"."AutoNumber")::text::text, 'timestamptz') OR __teable_input_is_valid(("t"."AutoNumber")::text::text, 'timestamp'))) THEN CASE WHEN (("t"."AutoNumber")::text IS NOT NULL AND NOT (__teable_input_is_valid(("t"."AutoNumber")::text::text, 'timestamptz') OR __teable_input_is_valid(("t"."AutoNumber")::text::text, 'timestamp'))) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (("t"."AutoNumber")::text IS NOT NULL AND NOT (__teable_input_is_valid(("t"."AutoNumber")::text::text, 'timestamptz') OR __teable_input_is_valid(("t"."AutoNumber")::text::text, 'timestamp'))) THEN NULL ELSE (CASE
      WHEN ("t"."AutoNumber")::text IS NULL THEN NULL
      WHEN __teable_input_is_valid(("t"."AutoNumber")::text::text, 'timestamptz') THEN (("t"."AutoNumber")::text)::timestamptz
      WHEN __teable_input_is_valid(("t"."AutoNumber")::text::text, 'timestamp') THEN (("t"."AutoNumber")::text::text)::timestamp AT TIME ZONE 'UTC'
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "DATETIME_PARSE({Button})",
  "funcId": "DatetimeParse",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "DATETIME_PARSE({Checkbox})",
  "funcId": "DatetimeParse",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (("t"."Checkbox")::text IS NOT NULL AND NOT (__teable_input_is_valid(("t"."Checkbox")::text::text, 'timestamptz') OR __teable_input_is_valid(("t"."Checkbox")::text::text, 'timestamp'))) THEN CASE WHEN (("t"."Checkbox")::text IS NOT NULL AND NOT (__teable_input_is_valid(("t"."Checkbox")::text::text, 'timestamptz') OR __teable_input_is_valid(("t"."Checkbox")::text::text, 'timestamp'))) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (("t"."Checkbox")::text IS NOT NULL AND NOT (__teable_input_is_valid(("t"."Checkbox")::text::text, 'timestamptz') OR __teable_input_is_valid(("t"."Checkbox")::text::text, 'timestamp'))) THEN NULL ELSE (CASE
      WHEN ("t"."Checkbox")::text IS NULL THEN NULL
      WHEN __teable_input_is_valid(("t"."Checkbox")::text::text, 'timestamptz') THEN (("t"."Checkbox")::text)::timestamptz
      WHEN __teable_input_is_valid(("t"."Checkbox")::text::text, 'timestamp') THEN (("t"."Checkbox")::text::text)::timestamp AT TIME ZONE 'UTC'
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "DATETIME_PARSE({ConditionalLookupType})",
  "funcId": "DatetimeParse",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN ((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  ) IS NOT NULL AND NOT (__teable_input_is_valid((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  )::text, 'timestamptz') OR __teable_input_is_valid((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  )::text, 'timestamp'))) THEN CASE WHEN ((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  ) IS NOT NULL AND NOT (__teable_input_is_valid((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  )::text, 'timestamptz') OR __teable_input_is_valid((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  )::text, 'timestamp'))) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN ((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  ) IS NOT NULL AND NOT (__teable_input_is_valid((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  )::text, 'timestamptz') OR __teable_input_is_valid((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  )::text, 'timestamp'))) THEN NULL ELSE (CASE
      WHEN (
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  ) IS NULL THEN NULL
      WHEN __teable_input_is_valid((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  )::text, 'timestamptz') THEN ((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  ))::timestamptz
      WHEN __teable_input_is_valid((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  )::text, 'timestamp') THEN ((
    SELECT string_agg((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END), ', ' ORDER BY ord)
    FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
  )::text)::timestamp AT TIME ZONE 'UTC'
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "DATETIME_PARSE({ConditionalRollupType})",
  "funcId": "DatetimeParse",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN (trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00')) IS NOT NULL AND NOT (__teable_input_is_valid(trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00'))::text, 'timestamptz') OR __teable_input_is_valid(trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00'))::text, 'timestamp'))) THEN CASE WHEN (trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00')) IS NOT NULL AND NOT (__teable_input_is_valid(trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00'))::text, 'timestamptz') OR __teable_input_is_valid(trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00'))::text, 'timestamp'))) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00')) IS NOT NULL AND NOT (__teable_input_is_valid(trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00'))::text, 'timestamptz') OR __teable_input_is_valid(trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00'))::text, 'timestamp'))) THEN NULL ELSE (CASE
      WHEN trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00')) IS NULL THEN NULL
      WHEN __teable_input_is_valid(trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00'))::text, 'timestamptz') THEN (trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00')))::timestamptz
      WHEN __teable_input_is_valid(trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00'))::text, 'timestamp') THEN (trim(to_char(("t"."ConditionalRollupType")::numeric, '999999990D00'))::text)::timestamp AT TIME ZONE 'UTC'
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "DATETIME_PARSE({CreatedBy})",
  "funcId": "DatetimeParse",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "DATETIME_PARSE({CreatedTime})",
  "funcId": "DatetimeParse",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0000-00-00 00:00:00.000+00",
  "sql": "("t"."CreatedTime")::timestamptz",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "DATETIME_PARSE({Date})",
  "funcId": "DatetimeParse",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "2024-02-03 00:00:00+00",
  "sql": "("t"."Date")::timestamptz",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "DATETIME_PARSE({FormulaType})",
  "funcId": "DatetimeParse",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (trim(to_char((10)::numeric, '999999990D00')) IS NOT NULL AND NOT (__teable_input_is_valid(trim(to_char((10)::numeric, '999999990D00'))::text, 'timestamptz') OR __teable_input_is_valid(trim(to_char((10)::numeric, '999999990D00'))::text, 'timestamp'))) THEN CASE WHEN (trim(to_char((10)::numeric, '999999990D00')) IS NOT NULL AND NOT (__teable_input_is_valid(trim(to_char((10)::numeric, '999999990D00'))::text, 'timestamptz') OR __teable_input_is_valid(trim(to_char((10)::numeric, '999999990D00'))::text, 'timestamp'))) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (trim(to_char((10)::numeric, '999999990D00')) IS NOT NULL AND NOT (__teable_input_is_valid(trim(to_char((10)::numeric, '999999990D00'))::text, 'timestamptz') OR __teable_input_is_valid(trim(to_char((10)::numeric, '999999990D00'))::text, 'timestamp'))) THEN NULL ELSE (CASE
      WHEN trim(to_char((10)::numeric, '999999990D00')) IS NULL THEN NULL
      WHEN __teable_input_is_valid(trim(to_char((10)::numeric, '999999990D00'))::text, 'timestamptz') THEN (trim(to_char((10)::numeric, '999999990D00')))::timestamptz
      WHEN __teable_input_is_valid(trim(to_char((10)::numeric, '999999990D00'))::text, 'timestamp') THEN (trim(to_char((10)::numeric, '999999990D00'))::text)::timestamp AT TIME ZONE 'UTC'
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "DATETIME_PARSE({LastModifiedBy})",
  "funcId": "DatetimeParse",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "DATETIME_PARSE({LastModifiedTime})",
  "funcId": "DatetimeParse",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "0000-00-00 00:00:00.000+00",
  "sql": "("t"."LastModifiedTime")::timestamptz",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "DATETIME_PARSE({LinkType})",
  "funcId": "DatetimeParse",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "DATETIME_PARSE({LongText})",
  "funcId": "DatetimeParse",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN ("t"."LongText" IS NOT NULL AND NOT (__teable_input_is_valid("t"."LongText"::text, 'timestamptz') OR __teable_input_is_valid("t"."LongText"::text, 'timestamp'))) THEN CASE WHEN ("t"."LongText" IS NOT NULL AND NOT (__teable_input_is_valid("t"."LongText"::text, 'timestamptz') OR __teable_input_is_valid("t"."LongText"::text, 'timestamp'))) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN ("t"."LongText" IS NOT NULL AND NOT (__teable_input_is_valid("t"."LongText"::text, 'timestamptz') OR __teable_input_is_valid("t"."LongText"::text, 'timestamp'))) THEN NULL ELSE (CASE
      WHEN "t"."LongText" IS NULL THEN NULL
      WHEN __teable_input_is_valid("t"."LongText"::text, 'timestamptz') THEN ("t"."LongText")::timestamptz
      WHEN __teable_input_is_valid("t"."LongText"::text, 'timestamp') THEN ("t"."LongText"::text)::timestamp AT TIME ZONE 'UTC'
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "DATETIME_PARSE({LookupType})",
  "funcId": "DatetimeParse",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN ((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    ) IS NOT NULL AND NOT (__teable_input_is_valid((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )::text, 'timestamptz') OR __teable_input_is_valid((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )::text, 'timestamp'))) THEN CASE WHEN ((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    ) IS NOT NULL AND NOT (__teable_input_is_valid((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )::text, 'timestamptz') OR __teable_input_is_valid((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )::text, 'timestamp'))) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN ((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    ) IS NOT NULL AND NOT (__teable_input_is_valid((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )::text, 'timestamptz') OR __teable_input_is_valid((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )::text, 'timestamp'))) THEN NULL ELSE (CASE
      WHEN (
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    ) IS NULL THEN NULL
      WHEN __teable_input_is_valid((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )::text, 'timestamptz') THEN ((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    ))::timestamptz
      WHEN __teable_input_is_valid((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )::text, 'timestamp') THEN ((
      SELECT string_agg(elem #>> '{}', ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )::text)::timestamp AT TIME ZONE 'UTC'
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "DATETIME_PARSE({MultipleSelect})",
  "funcId": "DatetimeParse",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "DATETIME_PARSE({Number})",
  "funcId": "DatetimeParse",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (trim(to_char(("t"."Number")::numeric, '999999990D00')) IS NOT NULL AND NOT (__teable_input_is_valid(trim(to_char(("t"."Number")::numeric, '999999990D00'))::text, 'timestamptz') OR __teable_input_is_valid(trim(to_char(("t"."Number")::numeric, '999999990D00'))::text, 'timestamp'))) THEN CASE WHEN (trim(to_char(("t"."Number")::numeric, '999999990D00')) IS NOT NULL AND NOT (__teable_input_is_valid(trim(to_char(("t"."Number")::numeric, '999999990D00'))::text, 'timestamptz') OR __teable_input_is_valid(trim(to_char(("t"."Number")::numeric, '999999990D00'))::text, 'timestamp'))) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (trim(to_char(("t"."Number")::numeric, '999999990D00')) IS NOT NULL AND NOT (__teable_input_is_valid(trim(to_char(("t"."Number")::numeric, '999999990D00'))::text, 'timestamptz') OR __teable_input_is_valid(trim(to_char(("t"."Number")::numeric, '999999990D00'))::text, 'timestamp'))) THEN NULL ELSE (CASE
      WHEN trim(to_char(("t"."Number")::numeric, '999999990D00')) IS NULL THEN NULL
      WHEN __teable_input_is_valid(trim(to_char(("t"."Number")::numeric, '999999990D00'))::text, 'timestamptz') THEN (trim(to_char(("t"."Number")::numeric, '999999990D00')))::timestamptz
      WHEN __teable_input_is_valid(trim(to_char(("t"."Number")::numeric, '999999990D00'))::text, 'timestamp') THEN (trim(to_char(("t"."Number")::numeric, '999999990D00'))::text)::timestamp AT TIME ZONE 'UTC'
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "DATETIME_PARSE({Rating})",
  "funcId": "DatetimeParse",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (("t"."Rating")::text IS NOT NULL AND NOT (__teable_input_is_valid(("t"."Rating")::text::text, 'timestamptz') OR __teable_input_is_valid(("t"."Rating")::text::text, 'timestamp'))) THEN CASE WHEN (("t"."Rating")::text IS NOT NULL AND NOT (__teable_input_is_valid(("t"."Rating")::text::text, 'timestamptz') OR __teable_input_is_valid(("t"."Rating")::text::text, 'timestamp'))) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (("t"."Rating")::text IS NOT NULL AND NOT (__teable_input_is_valid(("t"."Rating")::text::text, 'timestamptz') OR __teable_input_is_valid(("t"."Rating")::text::text, 'timestamp'))) THEN NULL ELSE (CASE
      WHEN ("t"."Rating")::text IS NULL THEN NULL
      WHEN __teable_input_is_valid(("t"."Rating")::text::text, 'timestamptz') THEN (("t"."Rating")::text)::timestamptz
      WHEN __teable_input_is_valid(("t"."Rating")::text::text, 'timestamp') THEN (("t"."Rating")::text::text)::timestamp AT TIME ZONE 'UTC'
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "DATETIME_PARSE({RollupType})",
  "funcId": "DatetimeParse",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "CASE WHEN (trim(to_char(("t"."RollupType")::numeric, '999999990D00')) IS NOT NULL AND NOT (__teable_input_is_valid(trim(to_char(("t"."RollupType")::numeric, '999999990D00'))::text, 'timestamptz') OR __teable_input_is_valid(trim(to_char(("t"."RollupType")::numeric, '999999990D00'))::text, 'timestamp'))) THEN CASE WHEN (trim(to_char(("t"."RollupType")::numeric, '999999990D00')) IS NOT NULL AND NOT (__teable_input_is_valid(trim(to_char(("t"."RollupType")::numeric, '999999990D00'))::text, 'timestamptz') OR __teable_input_is_valid(trim(to_char(("t"."RollupType")::numeric, '999999990D00'))::text, 'timestamp'))) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN (trim(to_char(("t"."RollupType")::numeric, '999999990D00')) IS NOT NULL AND NOT (__teable_input_is_valid(trim(to_char(("t"."RollupType")::numeric, '999999990D00'))::text, 'timestamptz') OR __teable_input_is_valid(trim(to_char(("t"."RollupType")::numeric, '999999990D00'))::text, 'timestamp'))) THEN NULL ELSE (CASE
      WHEN trim(to_char(("t"."RollupType")::numeric, '999999990D00')) IS NULL THEN NULL
      WHEN __teable_input_is_valid(trim(to_char(("t"."RollupType")::numeric, '999999990D00'))::text, 'timestamptz') THEN (trim(to_char(("t"."RollupType")::numeric, '999999990D00')))::timestamptz
      WHEN __teable_input_is_valid(trim(to_char(("t"."RollupType")::numeric, '999999990D00'))::text, 'timestamp') THEN (trim(to_char(("t"."RollupType")::numeric, '999999990D00'))::text)::timestamp AT TIME ZONE 'UTC'
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "DATETIME_PARSE({SingleLineText})",
  "funcId": "DatetimeParse",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN ("t"."SingleLineText" IS NOT NULL AND NOT (__teable_input_is_valid("t"."SingleLineText"::text, 'timestamptz') OR __teable_input_is_valid("t"."SingleLineText"::text, 'timestamp'))) THEN CASE WHEN ("t"."SingleLineText" IS NOT NULL AND NOT (__teable_input_is_valid("t"."SingleLineText"::text, 'timestamptz') OR __teable_input_is_valid("t"."SingleLineText"::text, 'timestamp'))) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE ((CASE WHEN ("t"."SingleLineText" IS NOT NULL AND NOT (__teable_input_is_valid("t"."SingleLineText"::text, 'timestamptz') OR __teable_input_is_valid("t"."SingleLineText"::text, 'timestamp'))) THEN NULL ELSE (CASE
      WHEN "t"."SingleLineText" IS NULL THEN NULL
      WHEN __teable_input_is_valid("t"."SingleLineText"::text, 'timestamptz') THEN ("t"."SingleLineText")::timestamptz
      WHEN __teable_input_is_valid("t"."SingleLineText"::text, 'timestamp') THEN ("t"."SingleLineText"::text)::timestamp AT TIME ZONE 'UTC'
      ELSE NULL
    END) END))::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "DATETIME_PARSE({SingleSelect})",
  "funcId": "DatetimeParse",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'DatetimeParse' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "DATETIME_PARSE({User})",
  "funcId": "DatetimeParse",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (NULL::timestamptz)::text END",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'attachment' 1`] = `
{
  "fieldType": "attachment",
  "formula": "TIMESTR({Attachment})",
  "funcId": "Timestr",
  "inputs": {
    "Attachment": {
      "fieldName": "Attachment",
      "fieldType": "attachment",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "[{"id": "att_1", "name": "10", "path": "/tmp/10", "size": 10, "token": "tok_1", "mimetype": "text/plain"}, {"id": "att_2", "name": "20", "path": "/tmp/20", "size": 20, "token": "tok_2", "mimetype": "text/plain"}]",
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::time::text END), ', ' ORDER BY ord)
      FROM jsonb_array_elements(COALESCE(NULLIF(("t"."Attachment")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'autoNumber' 1`] = `
{
  "fieldType": "autoNumber",
  "formula": "TIMESTR({AutoNumber})",
  "funcId": "Timestr",
  "inputs": {
    "AutoNumber": {
      "fieldName": "AutoNumber",
      "fieldType": "autoNumber",
      "formattedValue": "1",
      "formatting": undefined,
      "rawValue": "1",
    },
  },
  "result": "00:00:01",
  "sql": "((to_timestamp(("t"."AutoNumber")::double precision)) AT TIME ZONE 'UTC')::time::text",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'button' 1`] = `
{
  "fieldType": "button",
  "formula": "TIMESTR({Button})",
  "funcId": "Timestr",
  "inputs": {
    "Button": {
      "fieldName": "Button",
      "fieldType": "button",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::time::text END) END",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'checkbox' 1`] = `
{
  "fieldType": "checkbox",
  "formula": "TIMESTR({Checkbox})",
  "funcId": "Timestr",
  "inputs": {
    "Checkbox": {
      "fieldName": "Checkbox",
      "fieldType": "checkbox",
      "formattedValue": "true",
      "formatting": undefined,
      "rawValue": "true",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_boolean_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_boolean_to_datetime' ELSE (CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::time::text END) END",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'conditionalLookup' 1`] = `
{
  "fieldType": "conditionalLookup",
  "formula": "TIMESTR({ConditionalLookupType})",
  "funcId": "Timestr",
  "inputs": {
    "ConditionalLookupType": {
      "fieldName": "ConditionalLookupType",
      "fieldType": "conditionalLookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": null,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::time::text END), ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."ConditionalLookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'jsonb'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) = 'json'::regtype THEN ((("t"."ConditionalLookupType")))::jsonb
    WHEN pg_typeof((("t"."ConditionalLookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."ConditionalLookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."ConditionalLookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."ConditionalLookupType")))::text, 'jsonb') THEN (((("t"."ConditionalLookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."ConditionalLookupType")))
      END
    ELSE to_jsonb((("t"."ConditionalLookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'conditionalRollup' 1`] = `
{
  "fieldType": "conditionalRollup",
  "formula": "TIMESTR({ConditionalRollupType})",
  "funcId": "Timestr",
  "inputs": {
    "ConditionalRollupType": {
      "fieldName": "ConditionalRollupType",
      "fieldType": "conditionalRollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "((to_timestamp(("t"."ConditionalRollupType")::double precision)) AT TIME ZONE 'UTC')::time::text",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'createdBy' 1`] = `
{
  "fieldType": "createdBy",
  "formula": "TIMESTR({CreatedBy})",
  "funcId": "Timestr",
  "inputs": {
    "CreatedBy": {
      "fieldName": "CreatedBy",
      "fieldType": "createdBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::time::text END) END",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'createdTime' 1`] = `
{
  "fieldType": "createdTime",
  "formula": "TIMESTR({CreatedTime})",
  "funcId": "Timestr",
  "inputs": {
    "CreatedTime": {
      "fieldName": "CreatedTime",
      "fieldType": "createdTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "00:00:00.000",
  "sql": "((("t"."CreatedTime")::timestamptz) AT TIME ZONE 'UTC')::time::text",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'date' 1`] = `
{
  "fieldType": "date",
  "formula": "TIMESTR({Date})",
  "funcId": "Timestr",
  "inputs": {
    "Date": {
      "fieldName": "Date",
      "fieldType": "date",
      "formattedValue": "2024-02-03 00:00:00+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "2024-02-03 00:00:00+00",
    },
  },
  "result": "00:00:00",
  "sql": "((("t"."Date")::timestamptz) AT TIME ZONE 'UTC')::time::text",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'formula' 1`] = `
{
  "fieldType": "formula",
  "formula": "TIMESTR({FormulaType})",
  "funcId": "Timestr",
  "inputs": {
    "FormulaType": {
      "fieldName": "FormulaType",
      "fieldType": "formula",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": "00:00:10",
  "sql": "((to_timestamp((10)::double precision)) AT TIME ZONE 'UTC')::time::text",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'lastModifiedBy' 1`] = `
{
  "fieldType": "lastModifiedBy",
  "formula": "TIMESTR({LastModifiedBy})",
  "funcId": "Timestr",
  "inputs": {
    "LastModifiedBy": {
      "fieldName": "LastModifiedBy",
      "fieldType": "lastModifiedBy",
      "formattedValue": "System",
      "formatting": undefined,
      "rawValue": "{"id": "system", "email": null, "title": "System", "avatarUrl": "/api/attachments/read/public/avatar/system"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::time::text END) END",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'lastModifiedTime' 1`] = `
{
  "fieldType": "lastModifiedTime",
  "formula": "TIMESTR({LastModifiedTime})",
  "funcId": "Timestr",
  "inputs": {
    "LastModifiedTime": {
      "fieldName": "LastModifiedTime",
      "fieldType": "lastModifiedTime",
      "formattedValue": "0000-00-00 00:00:00.000+00",
      "formatting": {
        "date": "YYYY/MM/DD",
        "time": "HH:mm",
        "timeZone": "Asia/Shanghai",
      },
      "rawValue": "0000-00-00 00:00:00.000+00",
    },
  },
  "result": "00:00:00.000",
  "sql": "((("t"."LastModifiedTime")::timestamptz) AT TIME ZONE 'UTC')::time::text",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'link' 1`] = `
{
  "fieldType": "link",
  "formula": "TIMESTR({LinkType})",
  "funcId": "Timestr",
  "inputs": {
    "LinkType": {
      "fieldName": "LinkType",
      "fieldType": "link",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "{"id": "rec_*", "title": "10"}",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::time::text END) END",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'longText' 1`] = `
{
  "fieldType": "longText",
  "formula": "TIMESTR({LongText})",
  "funcId": "Timestr",
  "inputs": {
    "LongText": {
      "fieldName": "LongText",
      "fieldType": "longText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."LongText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."LongText" AS val) AS v) END)) AT TIME ZONE 'UTC')::time::text END) END",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'lookup' 1`] = `
{
  "fieldType": "lookup",
  "formula": "TIMESTR({LookupType})",
  "funcId": "Timestr",
  "inputs": {
    "LookupType": {
      "fieldName": "LookupType",
      "fieldType": "lookup",
      "formattedValue": "",
      "formatting": undefined,
      "innerField": {
        "fieldName": "LookupType",
        "fieldType": "singleLineText",
        "formattedValue": null,
        "formatting": undefined,
        "rawValue": null,
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::time::text END), ', ' ORDER BY ord)
      FROM jsonb_array_elements((SELECT CASE
        WHEN _lkp.v IS NULL THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'null' THEN '[]'::jsonb
        WHEN jsonb_typeof(_lkp.v) = 'array' THEN _lkp.v
        ELSE jsonb_build_array(_lkp.v)
      END FROM (SELECT (CASE
    WHEN (("t"."LookupType")) IS NULL THEN NULL
    WHEN pg_typeof((("t"."LookupType"))) = 'jsonb'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) = 'json'::regtype THEN ((("t"."LookupType")))::jsonb
    WHEN pg_typeof((("t"."LookupType"))) IN ('text', 'varchar', 'bpchar', 'character varying', 'unknown') THEN
      CASE
        WHEN NULLIF(BTRIM(((("t"."LookupType")))::text), '') IS NULL THEN NULL
        WHEN (LEFT(BTRIM(((("t"."LookupType")))::text), 1) IN ('[', '{')) AND __teable_input_is_valid(((("t"."LookupType")))::text, 'jsonb') THEN (((("t"."LookupType")))::text)::jsonb
        ELSE to_jsonb((("t"."LookupType")))
      END
    ELSE to_jsonb((("t"."LookupType")))
  END) AS v) AS _lkp)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'multipleSelect' 1`] = `
{
  "fieldType": "multipleSelect",
  "formula": "TIMESTR({MultipleSelect})",
  "funcId": "Timestr",
  "inputs": {
    "MultipleSelect": {
      "fieldName": "MultipleSelect",
      "fieldType": "multipleSelect",
      "formattedValue": "10, 20",
      "formatting": undefined,
      "rawValue": "["10", "20"]",
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::time::text END), ', ' ORDER BY ord)
      FROM jsonb_array_elements(COALESCE(NULLIF(("t"."MultipleSelect")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'number' 1`] = `
{
  "fieldType": "number",
  "formula": "TIMESTR({Number})",
  "funcId": "Timestr",
  "inputs": {
    "Number": {
      "fieldName": "Number",
      "fieldType": "number",
      "formattedValue": "10",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": "10",
    },
  },
  "result": "00:00:10",
  "sql": "((to_timestamp(("t"."Number")::double precision)) AT TIME ZONE 'UTC')::time::text",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'rating' 1`] = `
{
  "fieldType": "rating",
  "formula": "TIMESTR({Rating})",
  "funcId": "Timestr",
  "inputs": {
    "Rating": {
      "fieldName": "Rating",
      "fieldType": "rating",
      "formattedValue": "4",
      "formatting": undefined,
      "rawValue": "4",
    },
  },
  "result": "00:00:04",
  "sql": "((to_timestamp(("t"."Rating")::double precision)) AT TIME ZONE 'UTC')::time::text",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'rollup' 1`] = `
{
  "fieldType": "rollup",
  "formula": "TIMESTR({RollupType})",
  "funcId": "Timestr",
  "inputs": {
    "RollupType": {
      "fieldName": "RollupType",
      "fieldType": "rollup",
      "formattedValue": "",
      "formatting": {
        "precision": 2,
        "type": "decimal",
      },
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "((to_timestamp(("t"."RollupType")::double precision)) AT TIME ZONE 'UTC')::time::text",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'singleLineText' 1`] = `
{
  "fieldType": "singleLineText",
  "formula": "TIMESTR({SingleLineText})",
  "funcId": "Timestr",
  "inputs": {
    "SingleLineText": {
      "fieldName": "SingleLineText",
      "fieldType": "singleLineText",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE '#ERROR:TYPE:cannot_cast_to_datetime' END ELSE (CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT "t"."SingleLineText" AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT "t"."SingleLineText" AS val) AS v) END)) AT TIME ZONE 'UTC')::time::text END) END",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'singleSelect' 1`] = `
{
  "fieldType": "singleSelect",
  "formula": "TIMESTR({SingleSelect})",
  "funcId": "Timestr",
  "inputs": {
    "SingleSelect": {
      "fieldName": "SingleSelect",
      "fieldType": "singleSelect",
      "formattedValue": "10",
      "formatting": undefined,
      "rawValue": "10",
    },
  },
  "result": "#ERROR:TYPE:cannot_cast_to_datetime",
  "sql": "CASE WHEN TRUE THEN '#ERROR:TYPE:cannot_cast_to_datetime' ELSE (CASE WHEN TRUE THEN NULL ELSE ((NULL::timestamptz) AT TIME ZONE 'UTC')::time::text END) END",
}
`;

exports[`date functions batch 4 > 'Timestr' with 'user' 1`] = `
{
  "fieldType": "user",
  "formula": "TIMESTR({User})",
  "funcId": "Timestr",
  "inputs": {
    "User": {
      "fieldName": "User",
      "fieldType": "user",
      "formattedValue": "",
      "formatting": undefined,
      "rawValue": null,
    },
  },
  "result": null,
  "sql": "(
      SELECT string_agg((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (((CASE WHEN (SELECT (v.val IS NOT NULL AND NOT (__teable_input_is_valid((v.val)::text, 'timestamptz') OR __teable_input_is_valid((v.val)::text, 'timestamp'))) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) THEN NULL ELSE (SELECT (CASE
        WHEN v.val IS NULL THEN NULL::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamptz') THEN ((v.val)::text)::timestamptz
        WHEN __teable_input_is_valid((v.val)::text, 'timestamp') THEN ((v.val)::text)::timestamp AT TIME ZONE 'UTC'
        ELSE NULL::timestamptz
      END) FROM (SELECT ((CASE
    WHEN jsonb_typeof(elem) = 'object' THEN COALESCE(elem->>'title', elem->>'name', elem #>> '{}')
    WHEN jsonb_typeof(elem) = 'array' THEN NULL
    ELSE elem #>> '{}'
  END))::text AS val) AS v) END)) AT TIME ZONE 'UTC')::time::text END), ', ' ORDER BY ord)
      FROM jsonb_array_elements(COALESCE(NULLIF(("t"."User")::jsonb, 'null'::jsonb), '[]'::jsonb)) WITH ORDINALITY AS _jae(elem, ord)
    )",
}
`;
